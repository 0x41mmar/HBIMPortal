{"version":3,"sources":["webpack:///./src/client/viewer.components/Viewer.Toolkit/index.js?3d64*****************************","webpack:///./src/client/viewer.components/Viewer.Toolkit/Viewer.Toolkit.js?9bfb*****************************","webpack:///./src/client/viewer.components/Viewer.Extensions/Viewer.ExtensionBase/index.js?d1b9***************","webpack:///./src/client/viewer.components/Viewer.Extensions/Viewer.ExtensionBase/Viewer.ExtensionBase.js?48a7***************","webpack:///./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/index.js?659c","webpack:///./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/TransformGizmos.js?9015","webpack:///./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/Viewing.Extension.Transform.js?d118","webpack:///./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/Viewing.Tool.Rotate.js?c3fb","webpack:///./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/Viewing.Tool.Translate.js?8052"],"names":["Toolkit","format","d","Date","getTime","guid","replace","c","r","Math","random","floor","toString","urn","resolve","reject","paramUrn","startsWith","Autodesk","Viewing","Document","load","doc","error","roles","rootItem","getRootItem","items","roleArray","Array","isArray","forEach","role","getSubItemsWithProperties","type","id","className","tooltip","handler","button","UI","Button","icon","style","fontSize","setToolTip","onClick","viewer","ctrlGroupName","viewerToolbar","getToolbar","ctrlGroup","ControlGroup","addControl","model","dbIds","instanceTree","getData","getRootId","dbIdArray","leafIds","getLeafNodesRec","childCount","enumNodeChildren","childId","push","i","length","ex","getLeafNodes","fragIds","enumNodeFragments","fragId","leafId","dbId","getFragIds","fragList","getFragmentList","fragbBox","THREE","Box3","nodebBox","getWorldBounds","union","requestedProps","dbIdInt","parseInt","isNaN","propTasks","map","displayName","getProperty","all","then","properties","getProperties","result","defaultValue","prop","displayValue","Error","activeModel","propertyTasks","propertyResults","propertyResult","indexOf","sort","propFilter","propRes","filteredRes","filter","res","propFilterArray","getBulkProperties","components","defaultProp","getBulkPropertiesAsync","results","componentsMap","value","split","root","taskFunc","tasks","runTaskOnDataTreeRec","node","parent","children","childNode","task","min","max","material","overlayId","geometry","Geometry","vertices","Vector3","x","y","z","lines","Line","LinePieces","impl","addOverlay","invalidate","setMaterial","createNodeFunc","_buildModelTreeRec","name","getNodeName","rootId","rootNode","taskResults","_executeTaskOnModelTreeRec","hide","targetIds","visibilityManager","setNodeOff","show","isolate","targetLeafIds","leafTasks","resolveLeaf","axis","angle","center","quaternion","Quaternion","setFromAxisAngle","fragProxy","getFragmentProxy","getAnimTransform","position","applyQuaternion","add","multiplyQuaternions","updateAnimTransform","state","immediate","onStateRestored","removeEventListener","VIEWER_STATE_RESTORED_EVENT","pivot","viewport","pivotPoint","setTimeout","navigation","setPivotPoint","addEventListener","restoreState","parentId","nodeName","faceFilter","vertexArray","getLeafFragIds","matrixWorld","meshGeometry","renderProxy","getRenderProxy","attributes","positions","vb","array","indices","index","ib","stride","vbstride","offsets","count","start","oi","ol","il","a","b","vA","vB","vC","fromArray","faceIdx","face","Face3","faces","applyMatrix","computeFaceNormals","computeVertexNormals","mesh","Mesh","scale","excludedFragIds","svf","mc","getVisibleBounds","pt","nodeAccess","nodeBoxes","scaledExplodeDepth","maxDepth","explodeDepth","currentSegmentFraction","it","tmpBox","Float32Array","explodeRec","nodeId","depth","cx","cy","cz","ox","oy","oz","oscale","getNodeBox","mycx","mycy","mycz","dx","dy","dz","boxes","fragments","nbFrags","getCount","box_offset","getUserAgent","navigator","userAgent","isAndroid","match","isBlackBerry","isIOS","isOpera","isWindows","isWindowsDesktop","isWindowsMobile","isAny","ExtensionBase","options","_viewer","_options","eventId","eventIdArray","eventTasks","args","Composer","Extension","init_TransformGizmos","GizmoMaterial","parameters","MeshBasicMaterial","call","depthTest","depthWrite","side","FrontSide","transparent","setValues","oldColor","color","clone","oldOpacity","opacity","highlight","highlighted","setRGB","copy","prototype","GizmoLineMaterial","LineBasicMaterial","linewidth","PolyhedronGeometry","undefined","radius","detail","that","l","prepare","midpoints","p","j","v1","v2","v3","centroid","subdivide","faceVertexUvs","uvs","x0","x1","x2","multiplyScalar","mergeVertices","boundingSphere","Sphere","vector","vertex","normalize","u","azimuth","PI","v","inclination","uv","Vector2","make","divideScalar","azi","correctUV","cols","pow","cells","aj","lerp","bj","rows","k","atan2","sqrt","OctahedronGeometry","TorusGeometry","tube","radialSegments","tubularSegments","arc","normals","cos","sin","sub","createCircleGeometry","facing","createArrowGeometry","radiusTop","radiusBottom","height","heightSegments","openEnded","arrowGeometry","CylinderGeometry","updateMatrix","merge","matrix","createLineGeometry","lineGeometry","TransformGizmo","scope","showPickers","showActivePlane","init","Object3D","handles","pickers","planes","highlights","hemiPicker","subPickers","planeGeometry","PlaneBufferGeometry","planeMaterial","wireframe","DoubleSide","activePlane","rotation","set","visible","setupGizmos","activeMode","traverse","child","tempGeometry","BufferGeometry","fromBufferGeometry","addGizmos","gizmoMap","object","visble","setHandlePickerGizmos","handleGizmos","pickerGizmos","highlightGizmos","hemiPickerGizmos","subPickerGizmos","update","eye","vec1","vec2","lookAtMatrix","Matrix4","search","setFromRotationMatrix","lookAt","setFromEuler","TransformGizmoTranslate","lineXGeometry","lineYGeometry","lineZGeometry","X","Y","Z","XYZ","XY","YZ","XZ","BoxGeometry","setActivePlane","tempMatrix","applyMatrix4","getInverse","extractRotation","abs","TransformGizmoRotate","RX","RY","RZ","RE","RXYZE","eye2","apply","arguments","worldRotation","Euler","tempQuaternion","unitX","unitY","unitZ","quaternionX","quaternionY","quaternionZ","makeRotationFromQuaternion","TransformGizmoTranslateRotate","theta","SphereGeometry","useAllPickers","TransformGizmoScale","TransformControls","camera","domElement","mode","document","gizmo","snap","snapDelta","space","size","normal","startLine","endLine","LineDashedMaterial","centerLine","ImageUtils","loadTexture","Private","getResourceUrl","magFilter","minFilter","NearestFilter","CircleGeometry","centerMark","ticks","w","h","_dragging","_mode","_plane","changeEvent","mouseDownEvent","mouseUpEvent","objectChangeEvent","ray","Raycaster","pointerVector","pointerDir","point","offset","offsetRotation","tempVector","projX","projY","projZ","quaternionXYZ","quaternionE","oldPosition","oldScale","oldRotationMatrix","parentRotationMatrix","parentScale","worldPosition","worldRotationMatrix","camPosition","camRotation","attach","updateUnitVectors","detach","setMode","dispatchEvent","getPicker","setPosition","setNormal","setFromUnitVectors","multiply","setSnap","delta","setSize","setSpace","updateMatrixWorld","setFromMatrixPosition","applyEuler","dist","distanceTo","isPerspective","tan","fov","rect","getBoundingClientRect","showRotationGizmos","onPointerHover","event","pointer","pointers","intersect","intersectObjects","onPointerDown","pointerType","planeIntersect","setFromMatrixScale","verticesNeedUpdate","pos","getAttribute","pt1","fromAttribute","pt2","pt3","pt4","dashSize","gapSize","computeLineDistances","onPointerMove","dot","rotz","rotsnap","round","tempAxis","cross","rot","angleTo","projx","projy","projz","tempx","tempy","tempz","rotx","roty","matrixAutoUpdate","onPointerUp","remove","objects","clientX","left","width","clientY","top","unproject","transformDirection","intersections","TransformExtension","translateTool","rotateTool","transformedFragIdMap","on","selection","translateSelection","emit","data","transform","translation","_txControl","container","classList","_comboCtrl","rotateSelection","_rxControl","createButton","active","deactivate","translate","rotate","parentControl","hideControls","ComboButton","openCombo","e","contains","console","log","removeControl","activate","fullTransform","onPick","clearSelection","viewerState","currentExplodeScale","getExplodeScale","explodeScale","transforms","period","easingFunc","t","easeInOutExpo","animateTransform","sceneUpdated","targetState","currentFragIds","targetFragIds","fullFragIds","_x","_y","_z","_w","easing","fragProxyTasks","targetTransform","step","dQx","dQy","dQz","dQw","initialTransform","fragProxies","animationTasks","dt","ease","eased","_targetQuat","_initQuat","initQuat","targetQuat","slerp","targetPos","initPos","finalStep","parseFloat","targetScale","scaleStep","selectiveExplode","easedScale","explodeSlider","animationId","elapsed","stopwatch","animateTransformStep","getElapsedMs","requestAnimationFrame","cancelAnimationFrame","autocam","shotParams","duration","theExtensionManager","registerExtension","ExtensionId","RotateTool","keys","toolController","registerTool","onAggregateSelectionChangedHandler","onAggregateSelectionChanged","activateTool","getName","AGGREGATE_SELECTION_CHANGED_EVENT","deactivateTool","rotateControl","engaged","select","selections","fragIdsArray","fragCount","fragId2dbId","drawControl","fitToView","bBox","getWorldBoundingBox","RotateControl","rotateFragments","Control","isDragging","mousePos","sidewaysDirection","moveDirection","eyeDirection","upDirection","getCamera","target","up","crossVectors","setLength","keyCode","key","idx","euler","setFromQuaternion","overlayScene","canvas","gizmos","createOverlayScene","createAxis","worldup","createGizmo","picker","createSphere","angleLine","createLine","end","line","dir","orientation","cone","createCone","range","subMaterial","torusGizmo","subTorus","q","s","compose","plane","createBox","subGizmo","box","sphere","pointerToRaycaster","intersectResults","selectedGizmo","lastDir","intersectPoint","sign","pickerPoint","screenPoint","getScreenViewport","n","worldPoint","removeOverlayScene","colorInit","opacityInit","TranslateTool","_dbIds","_isDragging","_transformMesh","_selectedFragProxyMap","_transformControlTx","_hitPoint","onTxChange","bind","onCameraChanged","_selectionMode","MeshPhongMaterial","matman","addMaterial","_selection","pointerDown","setSelection","initializeSelection","hitPoint","modelTransform","CAMERA_CHANGE_EVENT","fragPosition","utilities","getHitPoint","bbox","getBoundingBox","getBoundingSphere","createTransformMesh","removeOverlay"],"mappings":"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","file":"48.js","sourcesContent":["import ViewerToolkit from './Viewer.Toolkit'\r\n\r\nexport default ViewerToolkit\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Toolkit/index.js","\r\n\r\nexport default class Toolkit {\r\n\r\n  ///////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////\r\n  static guid(format = 'xxxxxxxxxxxx') {\r\n\r\n    var d = new Date().getTime();\r\n\r\n    var guid = format.replace(\r\n      /[xy]/g,\r\n      function (c) {\r\n        var r = (d + Math.random() * 16) % 16 | 0;\r\n        d = Math.floor(d / 16);\r\n        return (c == 'x' ? r : (r & 0x7 | 0x8)).toString(16);\r\n      });\r\n\r\n    return guid;\r\n  }\r\n\r\n  /////////////////////////////////////////////\r\n  //mobile detection\r\n  //\r\n  /////////////////////////////////////////////\r\n  static get mobile() {\r\n\r\n    return {\r\n\r\n      getUserAgent: function () {\r\n        return navigator.userAgent;\r\n      },\r\n      isAndroid: function () {\r\n        return this.getUserAgent().match(/Android/i);\r\n      },\r\n      isBlackBerry: function () {\r\n        return this.getUserAgent().match(/BlackBerry/i);\r\n      },\r\n      isIOS: function () {\r\n        return this.getUserAgent().match(/iPhone|iPad|iPod/i);\r\n      },\r\n      isOpera: function () {\r\n        return this.getUserAgent().match(/Opera Mini/i);\r\n      },\r\n      isWindows: function () {\r\n        return this.isWindowsDesktop() || this.isWindowsMobile();\r\n      },\r\n      isWindowsMobile: function () {\r\n        return this.getUserAgent().match(/IEMobile/i);\r\n      },\r\n      isWindowsDesktop: function () {\r\n        return this.getUserAgent().match(/WPDesktop/i);\r\n      },\r\n      isAny: function () {\r\n\r\n        return this.isAndroid() ||\r\n          this.isBlackBerry() ||\r\n          this.isIOS() ||\r\n          this.isWindowsMobile();\r\n      }\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Load a document from URN\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static loadDocument (urn) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      const paramUrn = !urn.startsWith('urn:')\r\n        ? 'urn:' + urn\r\n        : urn\r\n\r\n      Autodesk.Viewing.Document.load(paramUrn, (doc) => {\r\n\r\n        resolve (doc)\r\n\r\n      }, (error) => {\r\n\r\n        reject (error)\r\n      })\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Return viewables\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getViewableItems (doc, roles = ['3d', '2d']) {\r\n\r\n    const rootItem = doc.getRootItem()\r\n\r\n    let items = []\r\n\r\n    const roleArray = roles\r\n      ? (Array.isArray(roles) ? roles : [roles])\r\n      : []\r\n\r\n    roleArray.forEach((role) => {\r\n\r\n      items = [ ...items,\r\n        ...Autodesk.Viewing.Document.getSubItemsWithProperties(\r\n          rootItem, { type: 'geometry', role }, true) ]\r\n    })\r\n\r\n    return items\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Toolbar button\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static createButton(id, className, tooltip, handler) {\r\n\r\n    var button = new Autodesk.Viewing.UI.Button(id)\r\n\r\n    button.icon.style.fontSize = '24px'\r\n\r\n    button.icon.className = className\r\n\r\n    button.setToolTip(tooltip)\r\n\r\n    button.onClick = handler\r\n\r\n    return button\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Control group\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static createControlGroup (viewer, ctrlGroupName) {\r\n\r\n    var viewerToolbar = viewer.getToolbar(true)\r\n\r\n    if (viewerToolbar) {\r\n\r\n      var ctrlGroup =  new Autodesk.Viewing.UI.ControlGroup(\r\n        ctrlGroupName)\r\n\r\n      viewerToolbar.addControl(ctrlGroup)\r\n\r\n      return ctrlGroup\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getLeafNodes (model, dbIds) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      try {\r\n\r\n        const instanceTree = model.getData().instanceTree\r\n\r\n        dbIds = dbIds || instanceTree.getRootId()\r\n\r\n        const dbIdArray = Array.isArray(dbIds) ? dbIds : [dbIds]\r\n\r\n        let leafIds = []\r\n\r\n        const getLeafNodesRec = (id) => {\r\n\r\n          var childCount = 0;\r\n\r\n          instanceTree.enumNodeChildren(id, (childId) => {\r\n\r\n              getLeafNodesRec(childId)\r\n\r\n              ++childCount\r\n            })\r\n\r\n          if (childCount == 0) {\r\n\r\n            leafIds.push(id)\r\n          }\r\n        }\r\n\r\n        for (var i = 0; i < dbIdArray.length; ++i) {\r\n\r\n          getLeafNodesRec(dbIdArray[i])\r\n        }\r\n\r\n        return resolve(leafIds)\r\n\r\n      } catch(ex){\r\n\r\n        return reject(ex)\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // get node fragIds\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getFragIds (model, dbIds) {\r\n\r\n    return new Promise(async(resolve, reject) => {\r\n\r\n      try {\r\n\r\n        const instanceTree = model.getData().instanceTree\r\n\r\n        dbIds = dbIds || instanceTree.getRootId()\r\n\r\n        const dbIdArray = Array.isArray(dbIds)\r\n          ? dbIds : [dbIds]\r\n\r\n        const leafIds =\r\n          await Toolkit.getLeafNodes(\r\n            model, dbIdArray)\r\n\r\n        const fragIds = []\r\n\r\n        for(var i=0; i< leafIds.length; ++i) {\r\n\r\n          instanceTree.enumNodeFragments(\r\n            leafIds[i], (fragId) => {\r\n              fragIds.push(fragId)\r\n            })\r\n        }\r\n\r\n        return resolve(fragIds)\r\n\r\n      } catch(ex) {\r\n\r\n        return reject(ex)\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // get leaf node fragIds\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getLeafFragIds (model, leafId) {\r\n\r\n    const instanceTree = model.getData().instanceTree\r\n\r\n    const fragIds = []\r\n\r\n    instanceTree.enumNodeFragments(\r\n      leafId, (fragId) => {\r\n        fragIds.push(fragId)\r\n      })\r\n\r\n    return fragIds\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Node bounding box\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getWorldBoundingBox (model, dbId) {\r\n\r\n    return new Promise(async(resolve, reject) => {\r\n\r\n      try {\r\n\r\n        var fragIds =\r\n          await Toolkit.getFragIds(\r\n            model, dbId)\r\n\r\n        if (!fragIds.length) {\r\n\r\n          return reject('No geometry, invalid dbId?')\r\n        }\r\n\r\n        var fragList = model.getFragmentList()\r\n\r\n        var fragbBox = new THREE.Box3()\r\n        var nodebBox = new THREE.Box3()\r\n\r\n        fragIds.forEach(function(fragId) {\r\n\r\n          fragList.getWorldBounds(fragId, fragbBox)\r\n          nodebBox.union(fragbBox)\r\n        })\r\n\r\n        return resolve(nodebBox)\r\n\r\n      } catch(ex){\r\n\r\n        return reject(ex)\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Gets properties from component\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getProperties (model, dbId, requestedProps = null) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      try {\r\n\r\n        const dbIdInt = parseInt(dbId)\r\n\r\n        if (isNaN(dbIdInt)) {\r\n\r\n          return reject(dbId + ' is not a valid integer')\r\n        }\r\n\r\n        if (requestedProps) {\r\n\r\n          const propTasks = requestedProps.map((displayName) => {\r\n\r\n            return Toolkit.getProperty(\r\n              model, dbIdInt, displayName, 'Not Available')\r\n          })\r\n\r\n          Promise.all(propTasks).then((properties) => {\r\n\r\n            resolve(properties)\r\n          })\r\n\r\n        } else {\r\n\r\n          model.getProperties(dbIdInt, (result) => {\r\n\r\n            if (result.properties) {\r\n\r\n              return resolve(\r\n                result.properties)\r\n            }\r\n\r\n            return reject('No Properties')\r\n          })\r\n        }\r\n\r\n      } catch (ex) {\r\n\r\n          return reject(ex)\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getProperty (model, dbId, displayName, defaultValue) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      try {\r\n\r\n        model.getProperties(dbId, (result) => {\r\n\r\n          if (result.properties) {\r\n\r\n            result.properties.forEach((prop) => {\r\n\r\n              prop.dbId = dbId\r\n\r\n              if (typeof displayName === 'function') {\r\n\r\n                if (displayName (prop.displayName)){\r\n\r\n                  resolve(prop)\r\n                }\r\n\r\n              } else if (displayName === prop.displayName) {\r\n\r\n                resolve(prop)\r\n              }\r\n            })\r\n\r\n            if (defaultValue) {\r\n\r\n              return resolve({\r\n                displayValue: defaultValue,\r\n                displayName,\r\n                dbId\r\n              })\r\n            }\r\n\r\n            reject(new Error('Not Found'))\r\n\r\n          } else {\r\n\r\n            reject(new Error('Error getting properties'));\r\n          }\r\n        })\r\n\r\n      } catch(ex){\r\n\r\n        return reject(ex)\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Gets all existing properties from component  dbIds\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getPropertyList (viewer, dbIds, model = null) {\r\n\r\n    return new Promise(async(resolve, reject) => {\r\n\r\n      try {\r\n\r\n        model = model || viewer.activeModel || viewer.model\r\n\r\n        var propertyTasks = dbIds.map((dbId) => {\r\n\r\n          return Toolkit.getProperties(model, dbId)\r\n        })\r\n\r\n        var propertyResults = await Promise.all(\r\n          propertyTasks)\r\n\r\n        var properties = []\r\n\r\n        propertyResults.forEach((propertyResult) => {\r\n\r\n          propertyResult.forEach((prop) => {\r\n\r\n            if (properties.indexOf(prop.displayName) < 0){\r\n\r\n              properties.push(prop.displayName)\r\n            }\r\n          })\r\n        })\r\n\r\n        return resolve(properties.sort())\r\n\r\n      } catch (ex) {\r\n\r\n        return reject(ex)\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getBulkPropertiesAsync (model, dbIds, propFilter) {\r\n\r\n    return new Promise(async(resolve, reject) => {\r\n\r\n      if (typeof propFilter === 'function') {\r\n\r\n        const propTasks = dbIds.map((dbId) => {\r\n\r\n          return this.getProperty(\r\n            model, dbId, propFilter, 'Not Found')\r\n        })\r\n\r\n        const propRes = await Promise.all(propTasks)\r\n\r\n        const filteredRes = propRes.filter((res) => {\r\n\r\n          return res.displayValue !== 'Not Found'\r\n        })\r\n\r\n        resolve(filteredRes.map((res) => {\r\n\r\n          return {\r\n            properties: [res],\r\n            dbId: res.dbId\r\n          }\r\n        }))\r\n\r\n      } else {\r\n\r\n        const propFilterArray = Array.isArray (propFilter)\r\n          ? propFilter :[propFilter]\r\n\r\n\r\n        model.getBulkProperties(dbIds, propFilterArray, (result) => {\r\n\r\n          resolve (result)\r\n\r\n        }, (error) => {\r\n\r\n          reject(error)\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Maps components by property\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static mapComponentsByProp (model, propFilter, components, defaultProp) {\r\n\r\n    return new Promise(async (resolve, reject) => {\r\n\r\n      try {\r\n\r\n        const results = await Toolkit.getBulkPropertiesAsync(\r\n          model, components, propFilter)\r\n\r\n        const propertyResults = results.map((result) => {\r\n\r\n          const prop = result.properties[0]\r\n\r\n          return Object.assign({}, prop, {\r\n            dbId: result.dbId\r\n          })\r\n        })\r\n\r\n        var componentsMap = {};\r\n\r\n        propertyResults.forEach((result) => {\r\n\r\n          var value = result.displayValue;\r\n\r\n          if (typeof value == 'string') {\r\n\r\n            value = value.split(':')[0]\r\n          }\r\n\r\n          if (!componentsMap[value]) {\r\n\r\n            componentsMap[value] = []\r\n          }\r\n\r\n          componentsMap[value].push(result.dbId)\r\n        })\r\n\r\n        return resolve(componentsMap)\r\n\r\n      } catch (ex) {\r\n\r\n        return reject(ex)\r\n      }\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////\r\n  // Runs recursively the argument task on each node\r\n  // of the data tree\r\n  //\r\n  /////////////////////////////////////////////////////////////\r\n  static runTaskOnDataTree(root, taskFunc) {\r\n\r\n    var tasks = [];\r\n\r\n    var runTaskOnDataTreeRec = (node, parent=null)=> {\r\n\r\n      if (node.children) {\r\n\r\n        node.children.forEach((childNode)=> {\r\n\r\n          runTaskOnDataTreeRec(childNode, node);\r\n        });\r\n      }\r\n\r\n      var task = taskFunc(node, parent);\r\n\r\n      tasks.push(task);\r\n    }\r\n\r\n    runTaskOnDataTreeRec(root);\r\n\r\n    return Promise.all(tasks);\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static drawBox (viewer, min, max, material, overlayId) {\r\n\r\n    const geometry = new THREE.Geometry()\r\n\r\n    geometry.vertices.push(new THREE.Vector3(min.x, min.y, min.z))\r\n    geometry.vertices.push(new THREE.Vector3(max.x, min.y, min.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(max.x, min.y, min.z))\r\n    geometry.vertices.push(new THREE.Vector3(max.x, min.y, max.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(max.x, min.y, max.z))\r\n    geometry.vertices.push(new THREE.Vector3(min.x, min.y, max.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(min.x, min.y, max.z))\r\n    geometry.vertices.push(new THREE.Vector3(min.x, min.y, min.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(min.x, max.y, max.z))\r\n    geometry.vertices.push(new THREE.Vector3(max.x, max.y, max.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(max.x, max.y, max.z))\r\n    geometry.vertices.push(new THREE.Vector3(max.x, max.y, min.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(max.x, max.y, min.z))\r\n    geometry.vertices.push(new THREE.Vector3(min.x, max.y, min.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(min.x, max.y, min.z))\r\n    geometry.vertices.push(new THREE.Vector3(min.x, max.y, max.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(min.x, min.y, min.z))\r\n    geometry.vertices.push(new THREE.Vector3(min.x, max.y, min.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(max.x, min.y, min.z))\r\n    geometry.vertices.push(new THREE.Vector3(max.x, max.y, min.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(max.x, min.y, max.z))\r\n    geometry.vertices.push(new THREE.Vector3(max.x, max.y, max.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(min.x, min.y, max.z))\r\n    geometry.vertices.push(new THREE.Vector3(min.x, max.y, max.z))\r\n\r\n    const lines = new THREE.Line(geometry,\r\n      material, THREE.LinePieces)\r\n\r\n    viewer.impl.addOverlay(overlayId, lines)\r\n\r\n    viewer.impl.invalidate(\r\n      true, true, true)\r\n\r\n    return lines\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Set component material\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static async setMaterial(model, dbId, material) {\r\n\r\n    const fragIds = await Toolkit.getFragIds(\r\n      model, dbId)\r\n\r\n    const fragList = model.getFragmentList()\r\n\r\n    fragIds.forEach((fragId) => {\r\n\r\n      fragList.setMaterial(fragId, material)\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Recursively builds the model tree\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static buildModelTree (model, createNodeFunc = null){\r\n\r\n    //builds model tree recursively\r\n    function _buildModelTreeRec(node){\r\n\r\n      instanceTree.enumNodeChildren(node.dbId,\r\n        function(childId) {\r\n\r\n          var childNode = null;\r\n\r\n          if(createNodeFunc){\r\n\r\n            childNode = createNodeFunc(childId);\r\n\r\n          } else {\r\n\r\n            node.children = node.children || [];\r\n\r\n            childNode = {\r\n              dbId: childId,\r\n              name: instanceTree.getNodeName(childId)\r\n            }\r\n\r\n            node.children.push(childNode)\r\n          }\r\n\r\n          _buildModelTreeRec(childNode)\r\n        })\r\n    }\r\n\r\n    //get model instance tree and root component\r\n    var instanceTree = model.getData().instanceTree\r\n\r\n    var rootId = instanceTree.getRootId()\r\n\r\n    var rootNode = {\r\n      dbId: rootId,\r\n      name: instanceTree.getNodeName(rootId)\r\n    }\r\n\r\n    _buildModelTreeRec(rootNode)\r\n\r\n    return rootNode\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Recursively execute task on model tree\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static executeTaskOnModelTree (model, task) {\r\n\r\n    var taskResults = [];\r\n\r\n    function _executeTaskOnModelTreeRec(dbId){\r\n\r\n      instanceTree.enumNodeChildren(dbId,\r\n        function(childId) {\r\n\r\n          taskResults.push(task(model, childId));\r\n\r\n          _executeTaskOnModelTreeRec(childId);\r\n        });\r\n    }\r\n\r\n    //get model instance tree and root component\r\n    var instanceTree = model.getData().instanceTree;\r\n\r\n    var rootId = instanceTree.getRootId();\r\n\r\n    _executeTaskOnModelTreeRec(rootId);\r\n\r\n    return taskResults;\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static hide (viewer, dbIds = [], model = null) {\r\n\r\n    try {\r\n\r\n      model = model || viewer.activeModel || viewer.model\r\n\r\n      viewer.hide (dbIds)\r\n\r\n      const targetIds = Array.isArray(dbIds) ? dbIds : [dbIds]\r\n\r\n      const tasks = targetIds.map((dbId) => {\r\n\r\n        return new Promise((resolve) => {\r\n\r\n          viewer.impl.visibilityManager.setNodeOff(\r\n            dbId, true)\r\n\r\n          resolve()\r\n        })\r\n      })\r\n\r\n      return Promise.all(tasks)\r\n\r\n    } catch (ex) {\r\n\r\n      return Promise.reject(ex)\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static show (viewer, dbIds = [], model = null) {\r\n\r\n    try {\r\n\r\n      model = model || viewer.activeModel || viewer.model\r\n\r\n      viewer.show (dbIds)\r\n\r\n      const targetIds = Array.isArray(dbIds) ? dbIds : [dbIds]\r\n\r\n      targetIds.forEach((dbId) => {\r\n\r\n        viewer.impl.visibilityManager.setNodeOff(\r\n          dbId, false)\r\n      })\r\n\r\n      return Promise.resolve()\r\n\r\n    } catch (ex) {\r\n\r\n      return Promise.reject(ex)\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static async isolateFull (viewer, dbIds = [], model = null) {\r\n\r\n    try {\r\n\r\n      model = model || viewer.activeModel || viewer.model\r\n\r\n      viewer.isolate(dbIds)\r\n\r\n      const targetIds = Array.isArray(dbIds) ? dbIds : [dbIds]\r\n\r\n      const targetLeafIds = await Toolkit.getLeafNodes(\r\n        model, targetIds)\r\n\r\n      const leafIds = await Toolkit.getLeafNodes (model)\r\n\r\n      const leafTasks = leafIds.map((dbId) => {\r\n\r\n        return new Promise((resolveLeaf) => {\r\n\r\n          const show = !targetLeafIds.length  ||\r\n            targetLeafIds.indexOf(dbId) > -1\r\n\r\n          viewer.impl.visibilityManager.setNodeOff(\r\n            dbId, !show)\r\n\r\n          resolveLeaf()\r\n        })\r\n      })\r\n\r\n      return Promise.all(leafTasks)\r\n\r\n    } catch (ex) {\r\n\r\n      return Promise.reject(ex)\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////\r\n  // Rotate selected fragments\r\n  //\r\n  ///////////////////////////////////////////////////////////////////\r\n  static rotateFragments (viewer, fragIds, axis, angle, center, model = null) {\r\n\r\n    var quaternion = new THREE.Quaternion()\r\n\r\n    quaternion.setFromAxisAngle(axis, angle)\r\n\r\n    model = model || viewer.activeModel || viewer.model\r\n\r\n    fragIds.forEach((fragId) => {\r\n\r\n      var fragProxy = viewer.impl.getFragmentProxy(\r\n        model, fragId)\r\n\r\n      fragProxy.getAnimTransform()\r\n\r\n      var position = new THREE.Vector3(\r\n        fragProxy.position.x - center.x,\r\n        fragProxy.position.y - center.y,\r\n        fragProxy.position.z - center.z)\r\n\r\n      position.applyQuaternion(quaternion)\r\n\r\n      position.add(center)\r\n\r\n      fragProxy.position = position\r\n\r\n      fragProxy.quaternion.multiplyQuaternions(\r\n        quaternion, fragProxy.quaternion)\r\n\r\n      fragProxy.updateAnimTransform()\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // A fix for viewer.restoreState\r\n  // that also restores pivotPoint\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static restoreStateWithPivot (\r\n    viewer, state, filter = null, immediate = false) {\r\n\r\n    const onStateRestored = () => {\r\n\r\n      viewer.removeEventListener(\r\n        Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,\r\n        onStateRestored)\r\n\r\n      const pivot = state.viewport.pivotPoint\r\n\r\n      setTimeout(() => {\r\n\r\n        viewer.navigation.setPivotPoint(\r\n          new THREE.Vector3(\r\n            pivot[0], pivot[1], pivot[2]))\r\n      }, immediate ? 0 : 1250)\r\n    }\r\n\r\n    viewer.addEventListener(\r\n      Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,\r\n      onStateRestored)\r\n\r\n    viewer.restoreState(state, filter, immediate)\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static getComponentsByParentName (name, model) {\r\n\r\n    const instanceTree = model.getData().instanceTree\r\n\r\n    const rootId = instanceTree.getRootId()\r\n\r\n    let parentId = 0\r\n\r\n    instanceTree.enumNodeChildren(rootId,\r\n      (childId) => {\r\n\r\n        const nodeName = instanceTree.getNodeName(childId)\r\n\r\n        if (nodeName.indexOf(name) > -1) {\r\n\r\n          parentId = childId\r\n        }\r\n      })\r\n\r\n    return parentId > 0\r\n      ? Toolkit.getLeafNodes(model, parentId)\r\n      : []\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Creates a standard THREE.Mesh out of a Viewer\r\n  // component\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static buildComponentMesh (\r\n    viewer, model, dbId, faceFilter, material) {\r\n\r\n    const vertexArray = []\r\n\r\n    // first we assume the component dbId is a leaf\r\n    // component: ie has no child so contains\r\n    // geometry. This util method will return all fragIds\r\n    // associated with that specific dbId\r\n    const fragIds = Toolkit.getLeafFragIds(model, dbId)\r\n\r\n    let matrixWorld = null\r\n\r\n    const meshGeometry = new THREE.Geometry()\r\n\r\n    fragIds.forEach((fragId) => {\r\n\r\n      // for each fragId, get the proxy in order to access\r\n      // THREE geometry\r\n      const renderProxy =\r\n        viewer.impl.getRenderProxy(\r\n          model, fragId)\r\n\r\n      matrixWorld = matrixWorld ||\r\n      renderProxy.matrixWorld\r\n\r\n      const geometry = renderProxy.geometry\r\n\r\n      const attributes = geometry.attributes\r\n\r\n      const positions = geometry.vb\r\n        ? geometry.vb\r\n        : attributes.position.array\r\n\r\n      const indices = attributes.index.array || geometry.ib\r\n\r\n      const stride = geometry.vb ? geometry.vbstride : 3\r\n\r\n      const offsets = [{\r\n        count: indices.length,\r\n        index: 0,\r\n        start: 0\r\n      }]\r\n\r\n      for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n        var start = offsets[oi].start\r\n        var count = offsets[oi].count\r\n        var index = offsets[oi].index\r\n\r\n        for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n          const a = index + indices[i]\r\n          const b = index + indices[i + 1]\r\n          const c = index + indices[i + 2]\r\n\r\n          const vA = new THREE.Vector3()\r\n          const vB = new THREE.Vector3()\r\n          const vC = new THREE.Vector3()\r\n\r\n          vA.fromArray(positions, a * stride)\r\n          vB.fromArray(positions, b * stride)\r\n          vC.fromArray(positions, c * stride)\r\n\r\n          if (!faceFilter || faceFilter(vA, vB, vC)) {\r\n\r\n            const faceIdx = meshGeometry.vertices.length\r\n\r\n            meshGeometry.vertices.push(vA)\r\n            meshGeometry.vertices.push(vB)\r\n            meshGeometry.vertices.push(vC)\r\n\r\n            const face = new THREE.Face3(\r\n              faceIdx, faceIdx + 1, faceIdx + 2)\r\n\r\n            meshGeometry.faces.push(face)\r\n          }\r\n        }\r\n      }\r\n    })\r\n\r\n    meshGeometry.applyMatrix(matrixWorld)\r\n    meshGeometry.computeFaceNormals()\r\n    meshGeometry.computeVertexNormals()\r\n\r\n    // creates THREE.Mesh\r\n    const mesh = new THREE.Mesh(\r\n      meshGeometry, material)\r\n\r\n    mesh.dbId = dbId\r\n\r\n    return mesh\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static selectiveExplode (viewer, scale, excludedFragIds, model = null) {\r\n\r\n    model = model || viewer.activeModel || viewer.model\r\n\r\n    var svf = model.getData();\r\n\r\n    var mc = model.getVisibleBounds(true).center();\r\n\r\n    var fragList = model.getFragmentList();\r\n\r\n    var pt = new THREE.Vector3();\r\n\r\n    //Input scale is in the range 0-1, where 0\r\n    //means no displacement, and 1 maximum reasonable displacement.\r\n    scale *= 2;\r\n\r\n    //If we have a full part hierarchy we can use a\r\n    //better grouping strategy when exploding\r\n    if (svf.instanceTree && svf.instanceTree.nodeAccess.nodeBoxes && scale !== 0) {\r\n\r\n      var scaledExplodeDepth = scale * (svf.instanceTree.maxDepth - 1) + 1;\r\n      var explodeDepth = 0 | scaledExplodeDepth;\r\n      var currentSegmentFraction = scaledExplodeDepth - explodeDepth;\r\n\r\n      var it = svf.instanceTree;\r\n      var tmpBox = new Float32Array(6);\r\n\r\n      (function explodeRec(nodeId, depth, cx, cy, cz, ox, oy, oz) {\r\n\r\n        var oscale = scale * 2;\r\n\r\n        // smooth transition of this tree depth\r\n        // from non-exploded to exploded state\r\n        if (depth == explodeDepth)\r\n          oscale *= currentSegmentFraction;\r\n\r\n        it.getNodeBox(nodeId, tmpBox);\r\n\r\n        var mycx = 0.5 * (tmpBox[0] + tmpBox[3]);\r\n        var mycy = 0.5 * (tmpBox[1] + tmpBox[4]);\r\n        var mycz = 0.5 * (tmpBox[2] + tmpBox[5]);\r\n\r\n        if (depth > 0 && depth <= explodeDepth) {\r\n          var dx = (mycx - cx) * oscale;\r\n          var dy = (mycy - cy) * oscale;\r\n          var dz = (mycz - cz) * oscale;\r\n\r\n          //var omax = Math.max(dx, Math.max(dy, dz));\r\n          ox += dx;\r\n          oy += dy;\r\n          oz += dz;\r\n        }\r\n\r\n        svf.instanceTree.enumNodeChildren(nodeId, function(dbId) {\r\n\r\n          explodeRec(dbId, depth+1, mycx, mycy, mycz, ox, oy, oz);\r\n\r\n        }, false);\r\n\r\n        svf.instanceTree.enumNodeFragments(nodeId, function(fragId) {\r\n\r\n          if (excludedFragIds.indexOf(fragId.toString()) < 0) {\r\n\r\n            pt.x = ox;\r\n            pt.y = oy;\r\n            pt.z = oz;\r\n\r\n            fragList.updateAnimTransform(fragId, null, null, pt);\r\n          }\r\n\r\n        }, false);\r\n\r\n      })(svf.instanceTree.getRootId(), 0, mc.x, mc.y, mc.x, 0, 0, 0);\r\n\r\n    } else {\r\n\r\n      var boxes = fragList.fragments.boxes;\r\n\r\n      var nbFrags = fragList.getCount()\r\n\r\n      for (var fragId = 0; fragId < nbFrags; ++fragId) {\r\n\r\n        if(excludedFragIds.indexOf(fragId.toString()) < 0) {\r\n\r\n          if (scale == 0) {\r\n\r\n            fragList.updateAnimTransform(fragId);\r\n\r\n          } else {\r\n\r\n            var box_offset = fragId * 6;\r\n\r\n            var cx = 0.5 * (boxes[box_offset] + boxes[box_offset + 3]);\r\n            var cy = 0.5 * (boxes[box_offset + 1] + boxes[box_offset + 4]);\r\n            var cz = 0.5 * (boxes[box_offset + 2] + boxes[box_offset + 5]);\r\n\r\n            cx = scale * (cx - mc.x);\r\n            cy = scale * (cy - mc.y);\r\n            cz = scale * (cz - mc.z);\r\n\r\n            pt.x = cx;\r\n            pt.y = cy;\r\n            pt.z = cz;\r\n\r\n            fragList.updateAnimTransform(fragId, null, null, pt);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Toolkit/Viewer.Toolkit.js","import ViewerExtensionBase from './Viewer.ExtensionBase'\r\n\r\nexport default ViewerExtensionBase\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Extensions/Viewer.ExtensionBase/index.js","import EventsEmitter from 'EventsEmitter'\r\n\r\nexport default class ExtensionBase extends\r\n  EventsEmitter.Composer (Autodesk.Viewing.Extension) {\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Class constructor\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  constructor (viewer, options = {}) {\r\n\r\n    super(viewer, options)\r\n\r\n    this._viewer = viewer\r\n    this.viewer = viewer\r\n\r\n    this._options = options\r\n    this.options = options\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Extension Id\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  static get ExtensionId() {\r\n\r\n    return 'Viewing.Extension.Base'\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////\r\n  static guid(format = 'xxxxxxxxxx') {\r\n\r\n    var d = new Date().getTime()\r\n\r\n    var guid = format.replace(\r\n      /[xy]/g,\r\n      function (c) {\r\n        var r = (d + Math.random() * 16) % 16 | 0\r\n        d = Math.floor(d / 16)\r\n        return (c == 'x' ? r : (r & 0x7 | 0x8)).toString(16)\r\n      })\r\n\r\n    return guid\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Load callback\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  load() {\r\n\r\n    return true\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Unload callback\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  unload() {\r\n\r\n    return true\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Reload callback\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  reload (options) {\r\n\r\n    return true\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////\r\n  // Async viewer event\r\n  //\r\n  /////////////////////////////////////////////////////////\r\n  viewerEvent (eventId) {\r\n\r\n    const eventIdArray = Array.isArray(eventId)\r\n      ? eventId : [eventId]\r\n\r\n    const eventTasks = eventIdArray.map((id) => {\r\n      return new Promise ((resolve) => {\r\n        const handler = (args) => {\r\n          this.viewer.removeEventListener (\r\n            id, handler)\r\n          resolve (args)\r\n        }\r\n        this.viewer.addEventListener (\r\n          id, handler)\r\n      })\r\n    })\r\n\r\n    return Promise.all(eventTasks)\r\n  }\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Extensions/Viewer.ExtensionBase/Viewer.ExtensionBase.js","import './Viewing.Extension.Transform'\r\n\r\nexport default 'Viewing.Extension.Transform'\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/index.js","(function init_TransformGizmos() {\r\n\r\n  'use strict';\r\n\r\n  var GizmoMaterial = function ( parameters ) {\r\n\r\n    THREE.MeshBasicMaterial.call( this );\r\n\r\n    this.depthTest = false;\r\n    this.depthWrite = false;\r\n    this.side = THREE.FrontSide;\r\n    this.transparent = true;\r\n\r\n    this.setValues( parameters );\r\n\r\n    this.oldColor = this.color.clone();\r\n    this.oldOpacity = this.opacity;\r\n\r\n    this.highlight = function( highlighted ) {\r\n\r\n      if ( highlighted ) {\r\n\r\n        this.color.setRGB( 1, 230/255, 3/255 );\r\n        this.opacity = 1;\r\n\r\n      } else {\r\n\r\n        this.color.copy( this.oldColor );\r\n        this.opacity = this.oldOpacity;\r\n\r\n      }\r\n\r\n    };\r\n\r\n  };\r\n\r\n  GizmoMaterial.prototype = Object.create( THREE.MeshBasicMaterial.prototype );\r\n\r\n  var GizmoLineMaterial = function ( parameters ) {\r\n\r\n    THREE.LineBasicMaterial.call( this );\r\n\r\n    this.depthTest = false;\r\n    this.depthWrite = false;\r\n    this.transparent = true;\r\n    this.linewidth = 3;\r\n\r\n    this.setValues( parameters );\r\n\r\n    this.oldColor = this.color.clone();\r\n    this.oldOpacity = this.opacity;\r\n\r\n    this.highlight = function( highlighted ) {\r\n\r\n      if ( highlighted ) {\r\n\r\n        this.color.setRGB( 1, 230/255, 3/255 );\r\n        this.opacity = 1;\r\n\r\n      } else {\r\n\r\n        this.color.copy( this.oldColor );\r\n        this.opacity = this.oldOpacity;\r\n\r\n      }\r\n\r\n    };\r\n\r\n  };\r\n\r\n  GizmoLineMaterial.prototype = Object.create( THREE.LineBasicMaterial.prototype );\r\n\r\n  // polyfill\r\n  if (THREE.PolyhedronGeometry === undefined) {\r\n    THREE.PolyhedronGeometry = function ( vertices, indices, radius, detail ) {\r\n\r\n      THREE.Geometry.call( this );\r\n\r\n      this.type = 'PolyhedronGeometry';\r\n\r\n      this.parameters = {\r\n        vertices: vertices,\r\n        indices: indices,\r\n        radius: radius,\r\n        detail: detail\r\n      };\r\n\r\n      radius = radius || 1;\r\n      detail = detail || 0;\r\n\r\n      var that = this;\r\n\r\n      for ( var i = 0, l = vertices.length; i < l; i += 3 ) {\r\n\r\n        prepare( new THREE.Vector3( vertices[ i ], vertices[ i + 1 ], vertices[ i + 2 ] ) );\r\n\r\n      }\r\n\r\n      var midpoints = [], p = this.vertices;\r\n\r\n      var faces = [];\r\n\r\n      for ( var i = 0, j = 0, l = indices.length; i < l; i += 3, j ++ ) {\r\n\r\n        var v1 = p[ indices[ i     ] ];\r\n        var v2 = p[ indices[ i + 1 ] ];\r\n        var v3 = p[ indices[ i + 2 ] ];\r\n\r\n        faces[ j ] = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ] );\r\n\r\n      }\r\n\r\n      var centroid = new THREE.Vector3();\r\n\r\n      for ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n        subdivide( faces[ i ], detail );\r\n\r\n      }\r\n\r\n\r\n      // Handle case when face straddles the seam\r\n\r\n      for ( var i = 0, l = this.faceVertexUvs[ 0 ].length; i < l; i ++ ) {\r\n\r\n        var uvs = this.faceVertexUvs[ 0 ][ i ];\r\n\r\n        var x0 = uvs[ 0 ].x;\r\n        var x1 = uvs[ 1 ].x;\r\n        var x2 = uvs[ 2 ].x;\r\n\r\n        var max = Math.max( x0, Math.max( x1, x2 ) );\r\n        var min = Math.min( x0, Math.min( x1, x2 ) );\r\n\r\n        if ( max > 0.9 && min < 0.1 ) { // 0.9 is somewhat arbitrary\r\n\r\n          if ( x0 < 0.2 ) uvs[ 0 ].x += 1;\r\n          if ( x1 < 0.2 ) uvs[ 1 ].x += 1;\r\n          if ( x2 < 0.2 ) uvs[ 2 ].x += 1;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // Apply radius\r\n\r\n      for ( var i = 0, l = this.vertices.length; i < l; i ++ ) {\r\n\r\n        this.vertices[ i ].multiplyScalar( radius );\r\n\r\n      }\r\n\r\n\r\n      // Merge vertices\r\n\r\n      this.mergeVertices();\r\n\r\n      this.computeFaceNormals();\r\n\r\n      this.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n\r\n      // Project vector onto sphere's surface\r\n\r\n      function prepare( vector ) {\r\n\r\n        var vertex = vector.normalize().clone();\r\n        vertex.index = that.vertices.push( vertex ) - 1;\r\n\r\n        // Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\r\n\r\n        var u = azimuth( vector ) / 2 / Math.PI + 0.5;\r\n        var v = inclination( vector ) / Math.PI + 0.5;\r\n        vertex.uv = new THREE.Vector2( u, 1 - v );\r\n\r\n        return vertex;\r\n\r\n      }\r\n\r\n\r\n      // Approximate a curved face with recursively sub-divided triangles.\r\n\r\n      function make( v1, v2, v3 ) {\r\n\r\n        var face = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ] );\r\n        that.faces.push( face );\r\n\r\n        centroid.copy( v1 ).add( v2 ).add( v3 ).divideScalar( 3 );\r\n\r\n        var azi = azimuth( centroid );\r\n\r\n        that.faceVertexUvs[ 0 ].push( [\r\n          correctUV( v1.uv, v1, azi ),\r\n          correctUV( v2.uv, v2, azi ),\r\n          correctUV( v3.uv, v3, azi )\r\n        ] );\r\n\r\n      }\r\n\r\n\r\n      // Analytically subdivide a face to the required detail level.\r\n\r\n      function subdivide( face, detail ) {\r\n\r\n        var cols = Math.pow(2, detail);\r\n        var cells = Math.pow(4, detail);\r\n        var a = prepare( that.vertices[ face.a ] );\r\n        var b = prepare( that.vertices[ face.b ] );\r\n        var c = prepare( that.vertices[ face.c ] );\r\n        var v = [];\r\n\r\n        // Construct all of the vertices for this subdivision.\r\n\r\n        for ( var i = 0 ; i <= cols; i ++ ) {\r\n\r\n          v[ i ] = [];\r\n\r\n          var aj = prepare( a.clone().lerp( c, i / cols ) );\r\n          var bj = prepare( b.clone().lerp( c, i / cols ) );\r\n          var rows = cols - i;\r\n\r\n          for ( var j = 0; j <= rows; j ++) {\r\n\r\n            if ( j == 0 && i == cols ) {\r\n\r\n              v[ i ][ j ] = aj;\r\n\r\n            } else {\r\n\r\n              v[ i ][ j ] = prepare( aj.clone().lerp( bj, j / rows ) );\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        // Construct all of the faces.\r\n\r\n        for ( var i = 0; i < cols ; i ++ ) {\r\n\r\n          for ( var j = 0; j < 2 * (cols - i) - 1; j ++ ) {\r\n\r\n            var k = Math.floor( j / 2 );\r\n\r\n            if ( j % 2 == 0 ) {\r\n\r\n              make(\r\n                v[ i ][ k + 1],\r\n                v[ i + 1 ][ k ],\r\n                v[ i ][ k ]\r\n              );\r\n\r\n            } else {\r\n\r\n              make(\r\n                v[ i ][ k + 1 ],\r\n                v[ i + 1][ k + 1],\r\n                v[ i + 1 ][ k ]\r\n              );\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // Angle around the Y axis, counter-clockwise when looking from above.\r\n\r\n      function azimuth( vector ) {\r\n\r\n        return Math.atan2( vector.z, - vector.x );\r\n\r\n      }\r\n\r\n\r\n      // Angle above the XZ plane.\r\n\r\n      function inclination( vector ) {\r\n\r\n        return Math.atan2( - vector.y, Math.sqrt( ( vector.x * vector.x ) + ( vector.z * vector.z ) ) );\r\n\r\n      }\r\n\r\n\r\n      // Texture fixing helper. Spheres have some odd behaviours.\r\n\r\n      function correctUV( uv, vector, azimuth ) {\r\n\r\n        if ( ( azimuth < 0 ) && ( uv.x === 1 ) ) uv = new THREE.Vector2( uv.x - 1, uv.y );\r\n        if ( ( vector.x === 0 ) && ( vector.z === 0 ) ) uv = new THREE.Vector2( azimuth / 2 / Math.PI + 0.5, uv.y );\r\n        return uv.clone();\r\n\r\n      }\r\n\r\n    };\r\n\r\n    THREE.PolyhedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\n  }\r\n\r\n  // polyfill\r\n  if (THREE.OctahedronGeometry === undefined) {\r\n    THREE.OctahedronGeometry = function ( radius, detail ) {\r\n\r\n      this.parameters = {\r\n        radius: radius,\r\n        detail: detail\r\n      };\r\n\r\n      var vertices = [\r\n        1, 0, 0,   - 1, 0, 0,    0, 1, 0,    0,- 1, 0,    0, 0, 1,    0, 0,- 1\r\n      ];\r\n\r\n      var indices = [\r\n        0, 2, 4,    0, 4, 3,    0, 3, 5,    0, 5, 2,    1, 2, 5,    1, 5, 3,    1, 3, 4,    1, 4, 2\r\n      ];\r\n\r\n      THREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n      this.type = 'OctahedronGeometry';\r\n\r\n      this.parameters = {\r\n        radius: radius,\r\n        detail: detail\r\n      };\r\n    };\r\n\r\n    THREE.OctahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\n  }\r\n\r\n  // polyfill\r\n  if (THREE.TorusGeometry === undefined) {\r\n    THREE.TorusGeometry = function ( radius, tube, radialSegments, tubularSegments, arc ) {\r\n\r\n      THREE.Geometry.call( this );\r\n\r\n      this.type = 'TorusGeometry';\r\n\r\n      this.parameters = {\r\n        radius: radius,\r\n        tube: tube,\r\n        radialSegments: radialSegments,\r\n        tubularSegments: tubularSegments,\r\n        arc: arc\r\n      };\r\n\r\n      radius = radius || 100;\r\n      tube = tube || 40;\r\n      radialSegments = radialSegments || 8;\r\n      tubularSegments = tubularSegments || 6;\r\n      arc = arc || Math.PI * 2;\r\n\r\n      var center = new THREE.Vector3(), uvs = [], normals = [];\r\n\r\n      for ( var j = 0; j <= radialSegments; j ++ ) {\r\n\r\n        for ( var i = 0; i <= tubularSegments; i ++ ) {\r\n\r\n          var u = i / tubularSegments * arc;\r\n          var v = j / radialSegments * Math.PI * 2;\r\n\r\n          center.x = radius * Math.cos( u );\r\n          center.y = radius * Math.sin( u );\r\n\r\n          var vertex = new THREE.Vector3();\r\n          vertex.x = ( radius + tube * Math.cos( v ) ) * Math.cos( u );\r\n          vertex.y = ( radius + tube * Math.cos( v ) ) * Math.sin( u );\r\n          vertex.z = tube * Math.sin( v );\r\n\r\n          this.vertices.push( vertex );\r\n\r\n          uvs.push( new THREE.Vector2( i / tubularSegments, j / radialSegments ) );\r\n          normals.push( vertex.clone().sub( center ).normalize() );\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for ( var j = 1; j <= radialSegments; j ++ ) {\r\n\r\n        for ( var i = 1; i <= tubularSegments; i ++ ) {\r\n\r\n          var a = ( tubularSegments + 1 ) * j + i - 1;\r\n          var b = ( tubularSegments + 1 ) * ( j - 1 ) + i - 1;\r\n          var c = ( tubularSegments + 1 ) * ( j - 1 ) + i;\r\n          var d = ( tubularSegments + 1 ) * j + i;\r\n\r\n          var face = new THREE.Face3( a, b, d, [ normals[ a ].clone(), normals[ b ].clone(), normals[ d ].clone() ] );\r\n          this.faces.push( face );\r\n          this.faceVertexUvs[ 0 ].push( [ uvs[ a ].clone(), uvs[ b ].clone(), uvs[ d ].clone() ] );\r\n\r\n          face = new THREE.Face3( b, c, d, [ normals[ b ].clone(), normals[ c ].clone(), normals[ d ].clone() ] );\r\n          this.faces.push( face );\r\n          this.faceVertexUvs[ 0 ].push( [ uvs[ b ].clone(), uvs[ c ].clone(), uvs[ d ].clone() ] );\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.computeFaceNormals();\r\n\r\n    };\r\n\r\n    THREE.TorusGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\n  }\r\n\r\n  var createCircleGeometry = function ( radius, facing, arc ) {\r\n\r\n    var geometry = new THREE.Geometry();\r\n    arc = arc ? arc : 1;\r\n    for ( var i = 0; i <= 64 * arc; ++i ) {\r\n      if ( facing == 'x' ) geometry.vertices.push( new THREE.Vector3( 0, Math.cos( i / 32 * Math.PI ), Math.sin( i / 32 * Math.PI ) ).multiplyScalar(radius) );\r\n      if ( facing == 'y' ) geometry.vertices.push( new THREE.Vector3( Math.cos( i / 32 * Math.PI ), 0, Math.sin( i / 32 * Math.PI ) ).multiplyScalar(radius) );\r\n      if ( facing == 'z' ) geometry.vertices.push( new THREE.Vector3( Math.sin( i / 32 * Math.PI ), Math.cos( i / 32 * Math.PI ), 0 ).multiplyScalar(radius) );\r\n    }\r\n\r\n    return geometry;\r\n  };\r\n\r\n  var createArrowGeometry = function ( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded ) {\r\n\r\n    var arrowGeometry = new THREE.Geometry();\r\n    var mesh = new THREE.Mesh( new THREE.CylinderGeometry( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded ) );\r\n    mesh.position.y = 0.5;\r\n    mesh.updateMatrix();\r\n\r\n    arrowGeometry.merge( mesh.geometry, mesh.matrix );\r\n\r\n    return arrowGeometry;\r\n  };\r\n\r\n  var createLineGeometry = function ( axis ) {\r\n\r\n    var lineGeometry = new THREE.Geometry();\r\n    if ( axis === 'X')\r\n      lineGeometry.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 1, 0, 0 ) );\r\n    else if ( axis === 'Y' )\r\n      lineGeometry.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 1, 0 ) );\r\n    else if ( axis === 'Z' )\r\n      lineGeometry.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 0, 1 ) );\r\n\r\n    return lineGeometry;\r\n  };\r\n\r\n  THREE.TransformGizmo = function () {\r\n\r\n    var scope = this;\r\n    var showPickers = false; //debug\r\n    var showActivePlane = false; //debug\r\n\r\n    this.init = function () {\r\n\r\n      THREE.Object3D.call( this );\r\n\r\n      this.handles = new THREE.Object3D();\r\n      this.pickers = new THREE.Object3D();\r\n      this.planes = new THREE.Object3D();\r\n      this.highlights = new THREE.Object3D();\r\n      this.hemiPicker = new THREE.Object3D();\r\n      this.subPickers = new THREE.Object3D();\r\n\r\n      this.add(this.handles);\r\n      this.add(this.pickers);\r\n      this.add(this.planes);\r\n      this.add(this.highlights);\r\n      this.add(this.hemiPicker);\r\n      this.add(this.subPickers);\r\n\r\n      //// PLANES\r\n\r\n      var planeGeometry = new THREE.PlaneBufferGeometry( 50, 50, 2, 2 );\r\n      var planeMaterial = new THREE.MeshBasicMaterial( { wireframe: true } );\r\n      planeMaterial.side = THREE.DoubleSide;\r\n\r\n      var planes = {\r\n        \"XY\":   new THREE.Mesh( planeGeometry, planeMaterial ),\r\n        \"YZ\":   new THREE.Mesh( planeGeometry, planeMaterial ),\r\n        \"XZ\":   new THREE.Mesh( planeGeometry, planeMaterial ),\r\n        \"XYZE\": new THREE.Mesh( planeGeometry, planeMaterial )\r\n      };\r\n\r\n      this.activePlane = planes[\"XYZE\"];\r\n\r\n      planes[\"YZ\"].rotation.set( 0, Math.PI/2, 0 );\r\n      planes[\"XZ\"].rotation.set( -Math.PI/2, 0, 0 );\r\n\r\n      for (var i in planes) {\r\n        planes[i].name = i;\r\n        this.planes.add(planes[i]);\r\n        this.planes[i] = planes[i];\r\n        planes[i].visible = false;\r\n      }\r\n\r\n      this.setupGizmos();\r\n      this.activeMode = \"\";\r\n\r\n      // reset Transformations\r\n\r\n      this.traverse(function ( child ) {\r\n        if (child instanceof THREE.Mesh) {\r\n          child.updateMatrix();\r\n\r\n          var tempGeometry = new THREE.Geometry();\r\n          if (child.geometry instanceof THREE.BufferGeometry) {\r\n            child.geometry = new THREE.Geometry().fromBufferGeometry( child.geometry );\r\n          }\r\n          tempGeometry.merge( child.geometry, child.matrix );\r\n\r\n          child.geometry = tempGeometry;\r\n          child.position.set( 0, 0, 0 );\r\n          child.rotation.set( 0, 0, 0 );\r\n          child.scale.set( 1, 1, 1 );\r\n        }\r\n      });\r\n\r\n    };\r\n\r\n    this.hide = function () {\r\n      this.traverse(function( child ) {\r\n        child.visible = false;\r\n      });\r\n    };\r\n\r\n    this.show = function () {\r\n      this.traverse(function( child ) {\r\n        child.visible = true;\r\n        if (child.parent == scope.pickers || child.parent == scope.hemiPicker ) child.visible = showPickers;\r\n        if (child.parent == scope.planes ) child.visible = false;\r\n      });\r\n      this.activePlane.visible = showActivePlane;\r\n    };\r\n\r\n    this.highlight = function ( axis ) {\r\n      this.traverse(function( child ) {\r\n        if ( child.material && child.material.highlight ) {\r\n          if ( child.name == axis ) {\r\n            child.material.highlight( true );\r\n          } else {\r\n            child.material.highlight( false );\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    this.setupGizmos = function () {\r\n\r\n      var addGizmos = function( gizmoMap, parent ) {\r\n\r\n        for ( var name in gizmoMap ) {\r\n\r\n          for ( var i = gizmoMap[name].length; i--;) {\r\n\r\n            var object = gizmoMap[name][i][0];\r\n            var position = gizmoMap[name][i][1];\r\n            var rotation = gizmoMap[name][i][2];\r\n            var visble = gizmoMap[name][i][3];\r\n\r\n            object.name = name;\r\n\r\n            if ( position ) object.position.set( position[0], position[1], position[2] );\r\n            if ( rotation ) object.rotation.set( rotation[0], rotation[1], rotation[2] );\r\n            if ( visble ) object.visble = visble;\r\n\r\n            parent.add( object );\r\n\r\n          }\r\n\r\n        }\r\n\r\n      };\r\n\r\n      this.setHandlePickerGizmos();\r\n\r\n      addGizmos(this.handleGizmos, this.handles);\r\n      addGizmos(this.pickerGizmos, this.pickers);\r\n      addGizmos(this.highlightGizmos, this.highlights);\r\n      addGizmos(this.hemiPickerGizmos, this.hemiPicker);\r\n      addGizmos(this.subPickerGizmos, this.subPickers);\r\n\r\n      this.hide();\r\n      this.show();\r\n\r\n    };\r\n\r\n  };\r\n\r\n  THREE.TransformGizmo.prototype = Object.create( THREE.Object3D.prototype );\r\n\r\n  THREE.TransformGizmo.prototype.update = function ( rotation, eye ) {\r\n\r\n    var vec1 = new THREE.Vector3( 0, 0, 0 );\r\n    var vec2 = new THREE.Vector3( 0, 1, 0 );\r\n    var lookAtMatrix = new THREE.Matrix4();\r\n\r\n    this.traverse(function(child) {\r\n      if ( child.name ) {\r\n        if ( child.name.search(\"E\") != -1 ) {\r\n          child.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( eye, vec1, vec2 ) );\r\n        } else if ( child.name.search(\"X\") != -1 || child.name.search(\"Y\") != -1 || child.name.search(\"Z\") != -1 ) {\r\n          child.quaternion.setFromEuler( rotation );\r\n        }\r\n      }\r\n    });\r\n\r\n  };\r\n\r\n  THREE.TransformGizmoTranslate = function () {\r\n\r\n    THREE.TransformGizmo.call( this );\r\n\r\n    this.setHandlePickerGizmos = function () {\r\n\r\n      var arrowGeometry = createArrowGeometry( 0, 0.05, 0.2, 12, 1, false );\r\n      var lineXGeometry = createLineGeometry( 'X' );\r\n      var lineYGeometry = createLineGeometry( 'Y' );\r\n      var lineZGeometry = createLineGeometry( 'Z' );\r\n\r\n      this.handleGizmos = {\r\n        X: [\r\n          [ new THREE.Mesh( arrowGeometry, new GizmoMaterial( { color: 0xf12c2c } ) ), [ 0.5, 0, 0 ], [ 0, 0, -Math.PI/2 ] ],\r\n          [ new THREE.Line( lineXGeometry, new GizmoLineMaterial( { color: 0xf12c2c } ) ) ]\r\n        ],\r\n        Y: [\r\n          [ new THREE.Mesh( arrowGeometry, new GizmoMaterial( { color: 0x0bb80b } ) ), [ 0, 0.5, 0 ] ],\r\n          [   new THREE.Line( lineYGeometry, new GizmoLineMaterial( { color: 0x0bb80b } ) ) ]\r\n        ],\r\n        Z: [\r\n          [ new THREE.Mesh( arrowGeometry, new GizmoMaterial( { color: 0x2c2cf1 } ) ), [ 0, 0, 0.5 ], [ Math.PI/2, 0, 0 ] ],\r\n          [ new THREE.Line( lineZGeometry, new GizmoLineMaterial( { color: 0x2c2cf1 } ) ) ]\r\n        ],\r\n        XYZ: [\r\n          [ new THREE.Mesh( new THREE.OctahedronGeometry( 0.1, 0 ), new GizmoMaterial( { color: 0xffffff, opacity: 0.25 } ) ), [ 0, 0, 0 ], [ 0, 0, 0 ] ]\r\n        ],\r\n        XY: [\r\n          [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.29, 0.29 ), new GizmoMaterial( { color: 0xffff00, opacity: 0.25 } ) ), [ 0.15, 0.15, 0 ] ]\r\n        ],\r\n        YZ: [\r\n          [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.29, 0.29 ), new GizmoMaterial( { color: 0x00ffff, opacity: 0.25 } ) ), [ 0, 0.15, 0.15 ], [ 0, Math.PI/2, 0 ] ]\r\n        ],\r\n        XZ: [\r\n          [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.29, 0.29 ), new GizmoMaterial( { color: 0xff00ff, opacity: 0.25 } ) ), [ 0.15, 0, 0.15 ], [ -Math.PI/2, 0, 0 ] ]\r\n        ]\r\n      };\r\n\r\n      this.pickerGizmos = {\r\n        X: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.2, 0, 1, 4, 1, false ), new GizmoMaterial( { color: 0xff0000, opacity: 0.25 } ) ), [ 0.6, 0, 0 ], [ 0, 0, -Math.PI/2 ] ]\r\n        ],\r\n        Y: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.2, 0, 1, 4, 1, false ), new GizmoMaterial( { color: 0x00ff00, opacity: 0.25 } ) ), [ 0, 0.6, 0 ] ]\r\n        ],\r\n        Z: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.2, 0, 1, 4, 1, false ), new GizmoMaterial( { color: 0x0000ff, opacity: 0.25 } ) ), [ 0, 0, 0.6 ], [ Math.PI/2, 0, 0 ] ]\r\n        ],\r\n        XYZ: [\r\n          [ new THREE.Mesh( new THREE.OctahedronGeometry( 0.2, 0 ), new GizmoMaterial( { color: 0xffffff, opacity: 0.25 } ) ) ]\r\n        ],\r\n        XY: [\r\n          [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), new GizmoMaterial( { color: 0xffff00, opacity: 0.25 } ) ), [ 0.2, 0.2, 0 ] ]\r\n        ],\r\n        YZ: [\r\n          [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), new GizmoMaterial( { color: 0x00ffff, opacity: 0.25 } ) ), [ 0, 0.2, 0.2 ], [ 0, Math.PI/2, 0 ] ]\r\n        ],\r\n        XZ: [\r\n          [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), new GizmoMaterial( { color: 0xff00ff, opacity: 0.25 } ) ), [ 0.2, 0, 0.2 ], [ -Math.PI/2, 0, 0 ] ]\r\n        ]\r\n      };\r\n\r\n      this.hemiPickerGizmos = {\r\n        XYZ: [\r\n          [ new THREE.Mesh( new THREE.BoxGeometry( 1.2, 1.2, 1.2 ), new GizmoMaterial( { color: 0x0000ff } ) ), [ 0.5, 0.5, 0.5 ], null, false ]\r\n        ]\r\n      };\r\n\r\n    };\r\n\r\n    this.setActivePlane = function ( axis, eye ) {\r\n\r\n      var tempMatrix = new THREE.Matrix4();\r\n      eye.applyMatrix4( tempMatrix.getInverse( tempMatrix.extractRotation( this.planes[ \"XY\" ].matrixWorld ) ) );\r\n\r\n      if ( axis == \"X\" ) {\r\n        this.activePlane = this.planes[ \"XY\" ];\r\n        if ( Math.abs(eye.y) > Math.abs(eye.z) ) this.activePlane = this.planes[ \"XZ\" ];\r\n      }\r\n\r\n      if ( axis == \"Y\" ){\r\n        this.activePlane = this.planes[ \"XY\" ];\r\n        if ( Math.abs(eye.x) > Math.abs(eye.z) ) this.activePlane = this.planes[ \"YZ\" ];\r\n      }\r\n\r\n      if ( axis == \"Z\" ){\r\n        this.activePlane = this.planes[ \"XZ\" ];\r\n        if ( Math.abs(eye.x) > Math.abs(eye.y) ) this.activePlane = this.planes[ \"YZ\" ];\r\n      }\r\n\r\n      if ( axis == \"XYZ\" ) this.activePlane = this.planes[ \"XYZE\" ];\r\n\r\n      if ( axis == \"XY\" ) this.activePlane = this.planes[ \"XY\" ];\r\n\r\n      if ( axis == \"YZ\" ) this.activePlane = this.planes[ \"YZ\" ];\r\n\r\n      if ( axis == \"XZ\" ) this.activePlane = this.planes[ \"XZ\" ];\r\n\r\n      this.hide();\r\n      this.show();\r\n\r\n    };\r\n\r\n    this.init();\r\n\r\n  };\r\n\r\n  THREE.TransformGizmoTranslate.prototype = Object.create( THREE.TransformGizmo.prototype );\r\n\r\n  THREE.TransformGizmoRotate = function () {\r\n\r\n    THREE.TransformGizmo.call( this );\r\n\r\n    this.setHandlePickerGizmos = function () {\r\n\r\n      this.handleGizmos = {\r\n        RX: [\r\n          [ new THREE.Line( createCircleGeometry(1,'x',0.5), new GizmoLineMaterial( { color: 0xff0000 } ) ) ]\r\n        ],\r\n        RY: [\r\n          [ new THREE.Line( createCircleGeometry(1,'y',0.5), new GizmoLineMaterial( { color: 0x00ff00 } ) ) ]\r\n        ],\r\n        RZ: [\r\n          [ new THREE.Line( createCircleGeometry(1,'z',0.5), new GizmoLineMaterial( { color: 0x0000ff } ) ) ]\r\n        ],\r\n        RE: [\r\n          [ new THREE.Line( createCircleGeometry(1.25,'z',1), new GizmoLineMaterial( { color: 0x00ffff } ) ) ]\r\n        ],\r\n        RXYZE: [\r\n          [ new THREE.Line( createCircleGeometry(1,'z',1), new GizmoLineMaterial( { color: 0xff00ff } ) ) ]\r\n        ]\r\n      };\r\n\r\n      this.pickerGizmos = {\r\n        RX: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.12, 4, 12, Math.PI ), new GizmoMaterial( { color: 0xff0000, opacity: 0.25 } ) ), [ 0, 0, 0 ], [ 0, -Math.PI/2, -Math.PI/2 ] ]\r\n        ],\r\n        RY: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.12, 4, 12, Math.PI ), new GizmoMaterial( { color: 0x00ff00, opacity: 0.25 } ) ), [ 0, 0, 0 ], [ Math.PI/2, 0, 0 ] ]\r\n        ],\r\n        RZ: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.12, 4, 12, Math.PI ), new GizmoMaterial( { color: 0x0000ff, opacity: 0.25 } ) ), [ 0, 0, 0 ], [ 0, 0, -Math.PI/2 ] ]\r\n        ],\r\n        RE: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1.25, 0.12, 2, 24 ), new GizmoMaterial( { color: 0x00ffff, opacity: 0.25 } ) ) ]\r\n        ],\r\n        RXYZE: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.12, 2, 24 ), new GizmoMaterial( { color: 0xff00ff, opacity: 0.25 } ) ) ]\r\n        ]\r\n      };\r\n\r\n    };\r\n\r\n    this.setActivePlane = function ( axis ) {\r\n\r\n      if ( axis == \"RE\" ) this.activePlane = this.planes[ \"XYZE\" ];\r\n\r\n      if ( axis == \"RX\" ) this.activePlane = this.planes[ \"YZ\" ];\r\n\r\n      if ( axis == \"RY\" ) this.activePlane = this.planes[ \"XZ\" ];\r\n\r\n      if ( axis == \"RZ\" ) this.activePlane = this.planes[ \"XY\" ];\r\n\r\n      this.hide();\r\n      this.show();\r\n\r\n    };\r\n\r\n    this.update = function ( rotation, eye2 ) {\r\n\r\n      THREE.TransformGizmo.prototype.update.apply( this, arguments );\r\n\r\n      var tempMatrix = new THREE.Matrix4();\r\n      var worldRotation = new THREE.Euler( 0, 0, 1 );\r\n      var tempQuaternion = new THREE.Quaternion();\r\n      var unitX = new THREE.Vector3( 1, 0, 0 );\r\n      var unitY = new THREE.Vector3( 0, 1, 0 );\r\n      var unitZ = new THREE.Vector3( 0, 0, 1 );\r\n      var quaternionX = new THREE.Quaternion();\r\n      var quaternionY = new THREE.Quaternion();\r\n      var quaternionZ = new THREE.Quaternion();\r\n      var eye = eye2.clone();\r\n\r\n      worldRotation.copy( this.planes[\"XY\"].rotation );\r\n      tempQuaternion.setFromEuler( worldRotation );\r\n\r\n      tempMatrix.makeRotationFromQuaternion( tempQuaternion ).getInverse( tempMatrix );\r\n      eye.applyMatrix4( tempMatrix );\r\n\r\n      this.traverse(function(child) {\r\n\r\n        tempQuaternion.setFromEuler( worldRotation );\r\n\r\n        if ( child.name == \"RX\" ) {\r\n          quaternionX.setFromAxisAngle( unitX, Math.atan2( -eye.y, eye.z ) );\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionX );\r\n          child.quaternion.copy( tempQuaternion );\r\n        }\r\n\r\n        if ( child.name == \"RY\" ) {\r\n          quaternionY.setFromAxisAngle( unitY, Math.atan2( eye.x, eye.z ) );\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionY );\r\n          child.quaternion.copy( tempQuaternion );\r\n        }\r\n\r\n        if ( child.name == \"RZ\" ) {\r\n          quaternionZ.setFromAxisAngle( unitZ, Math.atan2( eye.y, eye.x ) );\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionZ );\r\n          child.quaternion.copy( tempQuaternion );\r\n        }\r\n\r\n      });\r\n\r\n    };\r\n\r\n    this.init();\r\n\r\n  };\r\n\r\n  THREE.TransformGizmoRotate.prototype = Object.create( THREE.TransformGizmo.prototype );\r\n\r\n  THREE.TransformGizmoTranslateRotate = function () {\r\n\r\n    THREE.TransformGizmo.call( this );\r\n\r\n    var scope = this;\r\n\r\n    this.setHandlePickerGizmos = function () {\r\n\r\n      var arrowGeometry = createArrowGeometry( 0, 0.05, 0.2, 12, 1, false );\r\n      var lineGeometry = new THREE.Geometry();\r\n      lineGeometry.vertices.push( new THREE.Vector3( 0, 0, -0.1 ), new THREE.Vector3( 0, 0, 0.1 ), new THREE.Vector3( -0.1, 0, 0 ), new THREE.Vector3( 0.1, 0, 0 ) );\r\n      var theta = 0.15;\r\n\r\n      this.handleGizmos = {\r\n        Z: [\r\n          [ new THREE.Mesh( arrowGeometry, new GizmoMaterial( { color: 0xffffff } ) ), [ 0, 0, 0.25 ], [ Math.PI/2, 0, 0 ] ],\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.015, 0.015, 0.6, 4, 1, false ), new GizmoMaterial( { color: 0xffffff } ) ), [ 0, 0, 0.5 ],[ Math.PI/2, 0, 0 ] ]\r\n        ],\r\n        RX: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.015, 12, 60, theta * 2 * Math.PI ), new GizmoMaterial( { color: 0xff0000 } ) ), [ 0, 0, 0 ], [ theta * Math.PI, -Math.PI/2, 0 ] ],\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.05, 0.05, 0.015, 60, 1, false ), new GizmoMaterial( { color: 0xff0000 } ) ), [ 0, 0, 1 ], [ Math.PI/2, 0, 0 ] ]\r\n        ],\r\n        RY: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.015, 12, 60, theta * 2 * Math.PI ), new GizmoMaterial( { color: 0x0000ff } ) ), [ 0, 0, 0 ], [ Math.PI/2, 0, (0.5-theta)*Math.PI ] ],\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.05, 0.05, 0.01, 60, 1, false ), new GizmoMaterial( { color: 0x0000ff } ) ), [ 0, 0, 1 ] ]\r\n        ]\r\n      };\r\n\r\n      this.pickerGizmos = {\r\n        Z: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.12, 0.12, 0.65, 4, 1, false ), new GizmoMaterial( { color: 0x0000ff, opacity: 0.25 } ) ), [ 0, 0, 0.5 ], [ Math.PI/2, 0, 0 ] ]\r\n        ],\r\n        RX: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.12, 4, 12, theta * 2 * Math.PI ), new GizmoMaterial( { color: 0xff0000, opacity: 0.25 } ) ), [ 0, 0, 0 ], [ theta * Math.PI, -Math.PI/2, 0 ] ]\r\n        ],\r\n        RY: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.12, 4, 12, theta * 2 * Math.PI ), new GizmoMaterial( { color: 0x0000ff, opacity: 0.25 } ) ), [ 0, 0, 0 ], [ Math.PI/2, 0, (0.5-theta)*Math.PI ] ]\r\n        ]\r\n      };\r\n\r\n      this.subPickerGizmos = {\r\n        Z: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.12, 0.12, 0.65, 4, 1, false ), new GizmoMaterial( { color: 0x0000ff, opacity: 0.25 } ) ), [ 0, 0, 0.5 ], [ Math.PI/2, 0, 0 ] ]\r\n        ]\r\n      };\r\n\r\n      this.highlightGizmos = {\r\n        Z: [\r\n        ],\r\n        RX: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.02, 12, 60, 2 * Math.PI ), new GizmoMaterial( { color: 0xff0000, opacity: 1 } ) ), [ 0, 0, 0 ], [ 0, -Math.PI/2, -Math.PI/2 ], false ]\r\n        ],\r\n        RY: [\r\n          [ new THREE.Mesh( new THREE.TorusGeometry( 1, 0.02, 12, 60, 2 * Math.PI ), new GizmoMaterial( { color: 0x0000ff, opacity: 1 } ) ), [ 0, 0, 0 ], [ Math.PI/2, 0, 0 ], false ]\r\n        ]\r\n      };\r\n\r\n      this.hemiPickerGizmos = {\r\n        XYZ: [\r\n          [ new THREE.Mesh( new THREE.SphereGeometry( 1.2, 8, 8, 0, Math.PI ), new GizmoMaterial( { color: 0x0000ff } ) ), null, null, false ]\r\n        ]\r\n      };\r\n\r\n    };\r\n\r\n    this.setActivePlane = function ( axis, eye ) {\r\n\r\n      if ( this.activeMode == \"translate\" ) {\r\n\r\n        var tempMatrix = new THREE.Matrix4();\r\n        eye.applyMatrix4( tempMatrix.getInverse( tempMatrix.extractRotation( this.planes[ \"XY\" ].matrixWorld ) ) );\r\n\r\n        if ( axis == \"X\" ) {\r\n          this.activePlane = this.planes[ \"XY\" ];\r\n          if ( Math.abs(eye.y) > Math.abs(eye.z) ) this.activePlane = this.planes[ \"XZ\" ];\r\n        }\r\n\r\n        if ( axis == \"Y\" ){\r\n          this.activePlane = this.planes[ \"XY\" ];\r\n          if ( Math.abs(eye.x) > Math.abs(eye.z) ) this.activePlane = this.planes[ \"YZ\" ];\r\n        }\r\n\r\n        if ( axis == \"Z\" ){\r\n          this.activePlane = this.planes[ \"XZ\" ];\r\n          if ( Math.abs(eye.x) > Math.abs(eye.y) ) this.activePlane = this.planes[ \"YZ\" ];\r\n        }\r\n\r\n      } else if ( this.activeMode == \"rotate\" ){\r\n\r\n        if ( axis == \"RX\" ) this.activePlane = this.planes[ \"YZ\" ];\r\n\r\n        if ( axis == \"RY\" ) this.activePlane = this.planes[ \"XZ\" ];\r\n\r\n        if ( axis == \"RZ\" ) this.activePlane = this.planes[ \"XY\" ];\r\n\r\n      }\r\n\r\n      this.hide();\r\n      this.show();\r\n\r\n    };\r\n\r\n    this.update = function ( rotation, eye2 ) {\r\n\r\n      if ( this.activeMode == \"translate\" ) {\r\n\r\n        THREE.TransformGizmo.prototype.update.apply( this, arguments );\r\n\r\n      } else if ( this.activeMode == \"rotate\" ) {\r\n\r\n        THREE.TransformGizmo.prototype.update.apply( this, arguments );\r\n\r\n        var tempMatrix = new THREE.Matrix4();\r\n        var worldRotation = new THREE.Euler( 0, 0, 1 );\r\n        var tempQuaternion = new THREE.Quaternion();\r\n        var unitX = new THREE.Vector3( 1, 0, 0 );\r\n        var unitY = new THREE.Vector3( 0, 1, 0 );\r\n        var unitZ = new THREE.Vector3( 0, 0, 1 );\r\n        var quaternionX = new THREE.Quaternion();\r\n        var quaternionY = new THREE.Quaternion();\r\n        var quaternionZ = new THREE.Quaternion();\r\n        var eye = eye2.clone();\r\n\r\n        worldRotation.copy( this.planes[\"XY\"].rotation );\r\n        tempQuaternion.setFromEuler( worldRotation );\r\n\r\n        tempMatrix.makeRotationFromQuaternion( tempQuaternion ).getInverse( tempMatrix );\r\n        eye.applyMatrix4( tempMatrix );\r\n\r\n        this.traverse(function(child) {\r\n\r\n          tempQuaternion.setFromEuler( worldRotation );\r\n\r\n          if ( child.name == \"RX\" ) {\r\n            quaternionX.setFromAxisAngle( unitX, Math.atan2( -eye.y, eye.z ) );\r\n            tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionX );\r\n            child.quaternion.copy( tempQuaternion );\r\n          }\r\n\r\n          if ( child.name == \"RY\" ) {\r\n            quaternionY.setFromAxisAngle( unitY, Math.atan2( eye.x, eye.z ) );\r\n            tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionY );\r\n            child.quaternion.copy( tempQuaternion );\r\n          }\r\n\r\n          if ( child.name == \"RZ\" ) {\r\n            quaternionZ.setFromAxisAngle( unitZ, Math.atan2( eye.y, eye.x ) );\r\n            tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionZ );\r\n            child.quaternion.copy( tempQuaternion );\r\n          }\r\n\r\n        });\r\n\r\n      }\r\n\r\n    };\r\n\r\n    this.show = function () {\r\n      this.traverse(function( child ) {\r\n        if ( scope.parent == null || (scope.parent.useAllPickers || child.parent != scope.handles) ) child.visible = true;\r\n        if ( child.material ) child.material.opacity = child.material.oldOpacity;\r\n        if ( child.parent == scope.pickers || child.parent == scope.hemiPicker || child.parent == scope.subPickers) child.visible = false;\r\n        if ( child.parent == scope.planes || child.parent == scope.highlights ) child.visible = false;\r\n      });\r\n      this.activePlane.visible = false;\r\n    };\r\n\r\n    this.highlight = function ( axis ) {\r\n      this.traverse(function( child ) {\r\n        if ( child.material && child.material.highlight ) {\r\n          if ( child.name == axis ) {\r\n            if ( child.parent == scope.highlights || child.parent == scope.handles ) child.visible = true;\r\n            child.material.highlight( true );\r\n          } else {\r\n            child.material.highlight( false );\r\n            child.material.opacity = 0.1;\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    this.init();\r\n\r\n  };\r\n\r\n  THREE.TransformGizmoTranslateRotate.prototype = Object.create( THREE.TransformGizmo.prototype );\r\n\r\n  THREE.TransformGizmoScale = function () {\r\n\r\n    THREE.TransformGizmo.call( this );\r\n\r\n    this.setHandlePickerGizmos = function () {\r\n\r\n      var arrowGeometry = createArrowGeometry( 0.125, 0.125, 0.125 );\r\n      var lineXGeometry = createLineGeometry( 'X' );\r\n      var lineYGeometry = createLineGeometry( 'Y' );\r\n      var lineZGeometry = createLineGeometry( 'Z' );\r\n\r\n      this.handleGizmos = {\r\n        X: [\r\n          [ new THREE.Mesh( arrowGeometry, new GizmoMaterial( { color: 0xff0000 } ) ), [ 0.5, 0, 0 ], [ 0, 0, -Math.PI/2 ] ],\r\n          [ new THREE.Line( lineXGeometry, new GizmoLineMaterial( { color: 0xff0000 } ) ) ]\r\n        ],\r\n        Y: [\r\n          [ new THREE.Mesh( arrowGeometry, new GizmoMaterial( { color: 0x00ff00 } ) ), [ 0, 0.5, 0 ] ],\r\n          [ new THREE.Line( lineYGeometry, new GizmoLineMaterial( { color: 0x00ff00 } ) ) ]\r\n        ],\r\n        Z: [\r\n          [ new THREE.Mesh( arrowGeometry, new GizmoMaterial( { color: 0x0000ff } ) ), [ 0, 0, 0.5 ], [ Math.PI/2, 0, 0 ] ],\r\n          [ new THREE.Line( lineZGeometry, new GizmoLineMaterial( { color: 0x0000ff } ) ) ]\r\n        ],\r\n        XYZ: [\r\n          [ new THREE.Mesh( new THREE.BoxGeometry( 0.125, 0.125, 0.125 ), new GizmoMaterial( { color: 0xffffff, opacity: 0.25 } ) ) ]\r\n        ]\r\n      };\r\n\r\n      this.pickerGizmos = {\r\n        X: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.2, 0, 1, 4, 1, false ), new GizmoMaterial( { color: 0xff0000, opacity: 0.25 } ) ), [ 0.6, 0, 0 ], [ 0, 0, -Math.PI/2 ] ]\r\n        ],\r\n        Y: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.2, 0, 1, 4, 1, false ), new GizmoMaterial( { color: 0x00ff00, opacity: 0.25 } ) ), [ 0, 0.6, 0 ] ]\r\n        ],\r\n        Z: [\r\n          [ new THREE.Mesh( new THREE.CylinderGeometry( 0.2, 0, 1, 4, 1, false ), new GizmoMaterial( { color: 0x0000ff, opacity: 0.25 } ) ), [ 0, 0, 0.6 ], [ Math.PI/2, 0, 0 ] ]\r\n        ],\r\n        XYZ: [\r\n          [ new THREE.Mesh( new THREE.BoxGeometry( 0.4, 0.4, 0.4 ), new GizmoMaterial( { color: 0xffffff, opacity: 0.25 } ) ) ]\r\n        ]\r\n      };\r\n\r\n    };\r\n\r\n    this.setActivePlane = function ( axis, eye ) {\r\n\r\n      var tempMatrix = new THREE.Matrix4();\r\n      eye.applyMatrix4( tempMatrix.getInverse( tempMatrix.extractRotation( this.planes[ \"XY\" ].matrixWorld ) ) );\r\n\r\n      if ( axis == \"X\" ) {\r\n        this.activePlane = this.planes[ \"XY\" ];\r\n        if ( Math.abs(eye.y) > Math.abs(eye.z) ) this.activePlane = this.planes[ \"XZ\" ];\r\n      }\r\n\r\n      if ( axis == \"Y\" ){\r\n        this.activePlane = this.planes[ \"XY\" ];\r\n        if ( Math.abs(eye.x) > Math.abs(eye.z) ) this.activePlane = this.planes[ \"YZ\" ];\r\n      }\r\n\r\n      if ( axis == \"Z\" ){\r\n        this.activePlane = this.planes[ \"XZ\" ];\r\n        if ( Math.abs(eye.x) > Math.abs(eye.y) ) this.activePlane = this.planes[ \"YZ\" ];\r\n      }\r\n\r\n      if ( axis == \"XYZ\" ) this.activePlane = this.planes[ \"XYZE\" ];\r\n\r\n      this.hide();\r\n      this.show();\r\n\r\n    };\r\n\r\n    this.init();\r\n\r\n  };\r\n\r\n  THREE.TransformGizmoScale.prototype = Object.create( THREE.TransformGizmo.prototype );\r\n\r\n  THREE.TransformControls = function ( camera, domElement, mode ) {\r\n\r\n    // TODO: Make non-uniform scale and rotate play nice in hierarchies\r\n    // TODO: ADD RXYZ contol\r\n\r\n    THREE.Object3D.call( this );\r\n\r\n    domElement = ( domElement !== undefined ) ? domElement : document;\r\n\r\n    this.gizmo = {};\r\n    switch ( mode ) {\r\n      case \"translate\":\r\n        this.gizmo[mode] = new THREE.TransformGizmoTranslate();\r\n        break;\r\n      case \"rotate\":\r\n        this.gizmo[mode] = new THREE.TransformGizmoRotate();\r\n        break;\r\n      case \"transrotate\":\r\n        this.gizmo[mode] = new THREE.TransformGizmoTranslateRotate();\r\n        break;\r\n      case \"scale\":\r\n        this.gizmo[mode] = new THREE.TransformGizmoScale();\r\n        break;\r\n    }\r\n\r\n    this.add(this.gizmo[mode]);\r\n    this.gizmo[mode].hide();\r\n\r\n    this.object = undefined;\r\n    this.snap = null;\r\n    this.snapDelta = 0;\r\n    this.space = \"world\";\r\n    this.size = 1;\r\n    this.axis = null;\r\n    this.useAllPickers = true;\r\n\r\n    this.unitX = new THREE.Vector3( 1, 0, 0 );\r\n    this.unitY = new THREE.Vector3( 0, 1, 0 );\r\n    this.unitZ = new THREE.Vector3( 0, 0, 1 );\r\n    this.normal = new THREE.Vector3(0, 0, 1);\r\n\r\n    if ( mode === \"transrotate\" ) {\r\n      var geometry = new THREE.Geometry();\r\n      geometry.vertices.push( new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, 1) );\r\n      var material = new THREE.LineBasicMaterial( {color: 0x000000, linewidth:2, depthTest: false} );\r\n      this.startLine = new THREE.Line( geometry, material );\r\n      var geometry = new THREE.Geometry();\r\n      var material = new THREE.LineBasicMaterial( {color: 0xffe603, linewidth:2, depthTest: false} );\r\n      geometry.vertices.push( new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, 1) );\r\n      this.endLine = new THREE.Line( geometry, material );\r\n      var geometry = new THREE.Geometry();\r\n      var material = new THREE.LineDashedMaterial({color: 0x000000, linewidth:1, depthTest: false});\r\n      geometry.vertices.push( new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 1, 0) );\r\n      this.centerLine = new THREE.Line( geometry, material );\r\n\r\n      var map = THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl(\"res/textures/centerMarker_X.png\"));\r\n      map.magFilter = map.minFilter = THREE.NearestFilter;\r\n      var geometry = new THREE.CircleGeometry( 0.1, 32 );\r\n      var material = new THREE.MeshBasicMaterial({opacity: 1, side: THREE.DoubleSide, transparent:true, map:map});\r\n      this.centerMark = new THREE.Mesh( geometry, material );\r\n      this.centerMark.rotation.set(Math.PI/2, 0, 0);\r\n\r\n      this.ticks = {};\r\n      var map = THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl(\"res/textures/cardinalPoint.png\"));\r\n      map.magFilter = map.minFilter = THREE.NearestFilter;\r\n      var material = new THREE.MeshBasicMaterial({depthTest: false, opacity: 1, transparent:true, side: THREE.DoubleSide, map:map});\r\n      var w = 0.12, h = 0.25, d = 1.15;\r\n\r\n      this.ticks[\"RX\"] = new THREE.Object3D();\r\n      var geometry = new THREE.PlaneBufferGeometry(w, h);\r\n      var mesh = new THREE.Mesh(geometry, material);\r\n      mesh.position.set(0, 0, -d-h/2);\r\n      mesh.rotation.set(Math.PI/2, Math.PI/2, 0);\r\n      this.ticks[\"RX\"].add(mesh);\r\n\r\n      mesh = mesh.clone();\r\n      mesh.position.set(0, d+h/2, 0);\r\n      mesh.rotation.set(0, Math.PI/2, 0);\r\n      this.ticks[\"RX\"].add(mesh);\r\n\r\n      mesh = mesh.clone();\r\n      mesh.position.set(0, 0, d+h/2);\r\n      mesh.rotation.set(0, Math.PI/2, Math.PI/2);\r\n      this.ticks[\"RX\"].add(mesh);\r\n\r\n      mesh = mesh.clone();\r\n      mesh.position.set(0, -d-h/2, 0);\r\n      mesh.rotation.set(0, Math.PI/2, 0);\r\n      this.ticks[\"RX\"].add(mesh);\r\n\r\n      this.ticks[\"RY\"] = new THREE.Object3D();\r\n      mesh = mesh.clone();\r\n      mesh.position.set(0, 0, -d-h/2);\r\n      mesh.rotation.set(Math.PI/2, 0, 0);\r\n      this.ticks[\"RY\"].add(mesh);\r\n\r\n      mesh = mesh.clone();\r\n      mesh.position.set(-d-h/2, 0, 0);\r\n      mesh.rotation.set(Math.PI/2, 0, Math.PI/2);\r\n      this.ticks[\"RY\"].add(mesh);\r\n\r\n      mesh = mesh.clone();\r\n      mesh.position.set(0, 0, d+h/2);\r\n      mesh.rotation.set(Math.PI/2, 0, 0);\r\n      this.ticks[\"RY\"].add(mesh);\r\n\r\n      mesh = mesh.clone();\r\n      mesh.position.set(d+h/2, 0, 0);\r\n      mesh.rotation.set(Math.PI/2, 0, Math.PI/2);\r\n      this.ticks[\"RY\"].add(mesh);\r\n    }\r\n\r\n    var scope = this;\r\n\r\n    var _dragging = false;\r\n    var _mode = mode;\r\n    var _plane = \"XY\";\r\n\r\n    var changeEvent = { type: \"change\" };\r\n    var mouseDownEvent = { type: \"mouseDown\" };\r\n    var mouseUpEvent = { type: \"mouseUp\", mode: _mode };\r\n    var objectChangeEvent = { type: \"objectChange\" };\r\n\r\n    var ray = new THREE.Raycaster();\r\n    var pointerVector = new THREE.Vector3();\r\n    var pointerDir = new THREE.Vector3();\r\n\r\n    var point = new THREE.Vector3();\r\n    var offset = new THREE.Vector3();\r\n\r\n    var rotation = new THREE.Vector3();\r\n    var offsetRotation = new THREE.Vector3();\r\n    var scale = 1;\r\n\r\n    var lookAtMatrix = new THREE.Matrix4();\r\n    var eye = new THREE.Vector3();\r\n\r\n    var tempMatrix = new THREE.Matrix4();\r\n    var tempVector = new THREE.Vector3();\r\n    var tempQuaternion = new THREE.Quaternion();\r\n    var projX = new THREE.Vector3();\r\n    var projY = new THREE.Vector3();\r\n    var projZ = new THREE.Vector3();\r\n\r\n    var quaternionXYZ = new THREE.Quaternion();\r\n    var quaternionX = new THREE.Quaternion();\r\n    var quaternionY = new THREE.Quaternion();\r\n    var quaternionZ = new THREE.Quaternion();\r\n    var quaternionE = new THREE.Quaternion();\r\n\r\n    var oldPosition = new THREE.Vector3();\r\n    var oldScale = new THREE.Vector3();\r\n    var oldRotationMatrix = new THREE.Matrix4();\r\n\r\n    var parentRotationMatrix  = new THREE.Matrix4();\r\n    var parentScale = new THREE.Vector3();\r\n\r\n    var worldPosition = new THREE.Vector3();\r\n    var worldRotation = new THREE.Euler();\r\n    var worldRotationMatrix  = new THREE.Matrix4();\r\n    var camPosition = new THREE.Vector3();\r\n    var camRotation = new THREE.Euler();\r\n\r\n    this.attach = function ( object ) {\r\n\r\n      scope.object = object;\r\n\r\n      this.gizmo[_mode].show();\r\n\r\n      scope.update();\r\n\r\n      scope.updateUnitVectors();\r\n\r\n    };\r\n\r\n    this.detach = function ( object ) {\r\n\r\n      scope.object = undefined;\r\n      this.axis = null;\r\n\r\n      this.gizmo[_mode].hide();\r\n\r\n    };\r\n\r\n    this.setMode = function ( mode ) {\r\n\r\n      _mode = mode ? mode : _mode;\r\n\r\n      if ( _mode == \"scale\" ) scope.space = \"local\";\r\n\r\n      this.gizmo[_mode].show();\r\n\r\n      this.update();\r\n      scope.dispatchEvent( changeEvent );\r\n\r\n    };\r\n\r\n    this.getPicker = function () {\r\n\r\n      return scope.gizmo[_mode].hemiPicker.children;\r\n\r\n    };\r\n\r\n    this.setPosition = function ( position ) {\r\n\r\n      this.object.position.copy ( position );\r\n      this.update();\r\n\r\n    };\r\n\r\n    this.setNormal = function ( normal ) {\r\n\r\n      tempQuaternion.setFromUnitVectors( this.normal, normal );\r\n      this.unitX.applyQuaternion( tempQuaternion );\r\n      this.unitY.applyQuaternion( tempQuaternion );\r\n      this.unitZ.applyQuaternion( tempQuaternion );\r\n      this.normal.copy( normal );\r\n      if (this.object) {\r\n        this.object.quaternion.multiply ( tempQuaternion );\r\n      }\r\n      this.update();\r\n    };\r\n\r\n    this.setSnap = function ( snap, delta ) {\r\n\r\n      scope.snap = snap;\r\n      scope.snapDelta = delta;\r\n\r\n    };\r\n\r\n    this.setSize = function ( size ) {\r\n\r\n      scope.size = size;\r\n      this.update();\r\n      scope.dispatchEvent( changeEvent );\r\n\r\n    };\r\n\r\n    this.setSpace = function ( space ) {\r\n\r\n      scope.space = space;\r\n      this.update();\r\n      scope.dispatchEvent( changeEvent );\r\n\r\n    };\r\n\r\n    this.update = function (highlight) {\r\n\r\n      if ( scope.object === undefined ) return;\r\n\r\n      scope.object.updateMatrixWorld();\r\n      worldPosition.setFromMatrixPosition( scope.object.matrixWorld );\r\n      worldRotation.setFromRotationMatrix( tempMatrix.extractRotation( scope.object.matrixWorld ) );\r\n\r\n      camera.updateMatrixWorld();\r\n      camPosition.setFromMatrixPosition( camera.matrixWorld );\r\n      //camRotation.setFromRotationMatrix( tempMatrix.extractRotation( camera.matrixWorld ) );\r\n\r\n      this.position.copy( worldPosition );\r\n\r\n      this.quaternion.setFromEuler( worldRotation );\r\n\r\n      this.normal.set( 0, 0, 1 );\r\n      this.normal.applyEuler( worldRotation );\r\n\r\n      // keep same screen height (100px)\r\n      var dist = worldPosition.distanceTo( camPosition );\r\n      var height = camera.isPerspective? 2 * Math.tan( camera.fov * Math.PI / 360 ) * dist : dist;\r\n      var rect = domElement.getBoundingClientRect();\r\n      scale = 100 * height / rect.height;\r\n      this.scale.set( scale, scale, scale );\r\n\r\n      //eye.copy( camPosition ).sub( worldPosition ).normalize();\r\n\r\n      //if ( scope.space == \"local\" )\r\n      //    this.gizmo[_mode].update( worldRotation, eye );\r\n      //else if ( scope.space == \"world\" )\r\n      //    this.gizmo[_mode].update( new THREE.Euler(), eye );\r\n\r\n      if (highlight)\r\n        this.gizmo[_mode].highlight( scope.axis );\r\n\r\n    };\r\n\r\n    this.updateUnitVectors = function () {\r\n\r\n      this.unitX.set( 1, 0, 0 );\r\n      this.unitY.set( 0, 1, 0 );\r\n      this.unitZ.set( 0, 0, 1 );\r\n      this.unitX.applyEuler( worldRotation );\r\n      this.unitY.applyEuler( worldRotation );\r\n      this.unitZ.applyEuler( worldRotation );\r\n\r\n    };\r\n\r\n    this.showRotationGizmos = function (set) {\r\n\r\n      var handles = this.gizmo[_mode].handles.children;\r\n      for ( var i = 0; i < handles.length; i++ ) {\r\n        var child = handles[i];\r\n        child.visible = true;\r\n        if ( child.name.search(\"R\") !== -1 ) child.visible = set;\r\n      }\r\n      this.useAllPickers = set;\r\n\r\n    };\r\n\r\n    this.highlight = function () {\r\n\r\n      this.gizmo[_mode].highlight( this.axis || \"Z\" );\r\n\r\n    };\r\n\r\n    this.onPointerHover = function( event ) {\r\n\r\n      if ( scope.object === undefined || _dragging === true ) return false;\r\n\r\n      var pointer = event.pointers ? event.pointers[ 0 ] : event;\r\n\r\n      var intersect = intersectObjects( pointer, scope.useAllPickers? scope.gizmo[_mode].pickers.children: scope.gizmo[_mode].subPickers.children );\r\n\r\n      var axis = null;\r\n      var mode = \"\";\r\n\r\n      if ( intersect ) {\r\n\r\n        axis = intersect.object.name;\r\n        mode = axis.search(\"R\") != -1 ? \"rotate\" : \"translate\";\r\n\r\n      }\r\n\r\n      if ( scope.axis !== axis ) {\r\n\r\n        scope.axis = axis;\r\n        scope.gizmo[_mode].activeMode = mode;\r\n        scope.update(true);\r\n        scope.dispatchEvent( changeEvent );\r\n\r\n      }\r\n\r\n      if (scope.axis === null) {\r\n\r\n        scope.gizmo[_mode].show();\r\n\r\n      }\r\n\r\n      return intersect? true : false;\r\n\r\n    }\r\n\r\n    this.onPointerDown = function( event ) {\r\n\r\n      if ( scope.object === undefined || _dragging === true ) return false;\r\n\r\n      var pointer = event.pointers ? event.pointers[ 0 ] : event;\r\n\r\n      if ( event.pointerType === 'touch' ) {\r\n\r\n        var intersect = intersectObjects( pointer, scope.useAllPickers? scope.gizmo[_mode].pickers.children: scope.gizmo[_mode].subPickers.children );\r\n\r\n        var axis = null;\r\n        var mode = \"\";\r\n\r\n        if ( intersect ) {\r\n\r\n          axis = intersect.object.name;\r\n          mode = axis.search(\"R\") != -1 ? \"rotate\" : \"translate\";\r\n\r\n        }\r\n\r\n        if ( scope.axis !== axis ) {\r\n\r\n          scope.axis = axis;\r\n          scope.gizmo[_mode].activeMode = mode;\r\n        }\r\n      }\r\n\r\n      var intersect = null;\r\n\r\n      if ( pointer.button === 0 || pointer.button === undefined ) {\r\n\r\n        intersect = intersectObjects( pointer, scope.useAllPickers? scope.gizmo[_mode].pickers.children: scope.gizmo[_mode].subPickers.children );\r\n\r\n        if ( intersect ) {\r\n\r\n          scope.dispatchEvent( mouseDownEvent );\r\n\r\n          scope.axis = intersect.object.name;\r\n\r\n          scope.update();\r\n\r\n          eye.copy( camera.position ).sub( worldPosition ).normalize();\r\n\r\n          scope.gizmo[_mode].setActivePlane( scope.axis, eye );\r\n\r\n          var planeIntersect = intersectObjects( pointer, [scope.gizmo[_mode].activePlane] );\r\n\r\n          if ( planeIntersect )\r\n            offset.copy( planeIntersect.point );\r\n\r\n          oldPosition.copy( scope.object.position );\r\n          oldScale.copy( scope.object.scale );\r\n\r\n          oldRotationMatrix.extractRotation( scope.object.matrix );\r\n          worldRotationMatrix.extractRotation( scope.object.matrixWorld );\r\n\r\n          if ( scope.object.parent ) {\r\n            parentRotationMatrix.extractRotation( scope.object.parent.matrixWorld );\r\n            parentScale.setFromMatrixScale( tempMatrix.getInverse( scope.object.parent.matrixWorld ) );\r\n          } else {\r\n            parentRotationMatrix.extractRotation( scope.object.matrixWorld );\r\n            parentScale.setFromMatrixScale( tempMatrix.getInverse( scope.object.matrixWorld ) );\r\n          }\r\n\r\n          // show rotation start line and ticks\r\n          if ( _mode === \"transrotate\" && scope.gizmo[_mode].activeMode === \"rotate\" ) {\r\n            scope.startLine.geometry.vertices[0].set(0, 0, 0).applyMatrix4( scope.matrixWorld );\r\n            scope.startLine.geometry.vertices[1].set(0, 0, 1).applyMatrix4( scope.matrixWorld );\r\n            scope.startLine.geometry.verticesNeedUpdate = true;\r\n            scope.parent.add( scope.startLine );\r\n\r\n            var pos = scope.object.geometry.getAttribute('position');\r\n            var pt1 = new THREE.Vector3().fromAttribute(pos, 0).applyMatrix4( scope.object.matrixWorld );\r\n            var pt2 = new THREE.Vector3().fromAttribute(pos, 1).applyMatrix4( scope.object.matrixWorld );\r\n            var pt3 = new THREE.Vector3().fromAttribute(pos, 2).applyMatrix4( scope.object.matrixWorld );\r\n            var pt4 = new THREE.Vector3().fromAttribute(pos, 3).applyMatrix4( scope.object.matrixWorld );\r\n            if (scope.axis === \"RX\") {\r\n              pt1.lerp(pt3, 0.5);\r\n              pt2.lerp(pt4, 0.5);\r\n              var dist = pt1.distanceTo(pt2);\r\n              scope.centerLine.material.dashSize = dist / 15;\r\n              scope.centerLine.material.gapSize = dist / 30;\r\n              scope.centerLine.geometry.vertices[0].copy(pt1);\r\n              scope.centerLine.geometry.vertices[1].copy(pt2);\r\n            } else {\r\n              pt1.lerp(pt2, 0.5);\r\n              pt3.lerp(pt4, 0.5);\r\n              var dist = pt1.distanceTo(pt3);\r\n              scope.centerLine.material.dashSize = dist / 15;\r\n              scope.centerLine.material.gapSize = dist / 30;\r\n              scope.centerLine.geometry.vertices[0].copy(pt1);\r\n              scope.centerLine.geometry.vertices[1].copy(pt3);\r\n            }\r\n            scope.centerLine.geometry.computeLineDistances();\r\n            scope.centerLine.geometry.verticesNeedUpdate = true;\r\n            scope.parent.add( scope.centerLine );\r\n\r\n            scope.ticks[scope.axis].position.copy( scope.position );\r\n            scope.ticks[scope.axis].quaternion.copy( scope.quaternion );\r\n            scope.ticks[scope.axis].scale.copy( scope.scale );\r\n            scope.parent.add( scope.ticks[scope.axis] );\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _dragging = true;\r\n\r\n      return intersect? true: false;\r\n\r\n    }\r\n\r\n    this.onPointerMove = function( event ) {\r\n\r\n      if ( scope.object === undefined || scope.axis === null || _dragging === false ) return false;\r\n\r\n      var pointer = event.pointers ? event.pointers[ 0 ] : event;\r\n\r\n      var planeIntersect = intersectObjects( pointer, [scope.gizmo[_mode].activePlane] );\r\n\r\n      if ( planeIntersect )\r\n        point.copy( planeIntersect.point );\r\n\r\n      var mode = scope.gizmo[_mode].activeMode;\r\n      if ( mode == \"translate\" ) {\r\n\r\n        point.sub( offset );\r\n        point.multiply(parentScale);\r\n\r\n        if ( scope.space == \"local\" ) {\r\n\r\n          point.applyMatrix4( tempMatrix.getInverse( worldRotationMatrix ) );\r\n\r\n          projX.copy( this.unitX );\r\n          projY.copy( this.unitY );\r\n          projZ.copy( this.unitZ );\r\n          tempVector.set( 0, 0, 0 );\r\n          if ( scope.axis.search(\"X\") != -1 ) {\r\n            projX.multiplyScalar( point.dot( this.unitX ) );\r\n            tempVector.add( projX );\r\n          }\r\n          if ( scope.axis.search(\"Y\") != -1 ) {\r\n            projY.multiplyScalar( point.dot( this.unitY ) );\r\n            tempVector.add(projY);\r\n          }\r\n          if ( scope.axis.search(\"Z\") != -1 ) {\r\n            projZ.multiplyScalar( point.dot( this.unitZ ) );\r\n            tempVector.add( projZ );\r\n          }\r\n          point.copy( tempVector );\r\n\r\n          point.applyMatrix4( oldRotationMatrix );\r\n\r\n          scope.object.position.copy( oldPosition );\r\n          scope.object.position.add( point );\r\n\r\n        }\r\n\r\n        if ( scope.space == \"world\" || scope.axis.search(\"XYZ\") != -1 ) {\r\n\r\n          projX.copy( this.unitX );\r\n          projY.copy( this.unitY );\r\n          projZ.copy( this.unitZ );\r\n          tempVector.set( 0, 0, 0 );\r\n          if ( scope.axis.search(\"X\") != -1 ) {\r\n            projX.multiplyScalar( point.dot( this.unitX ) );\r\n            tempVector.add( projX );\r\n          }\r\n          if ( scope.axis.search(\"Y\") != -1 ) {\r\n            projY.multiplyScalar( point.dot( this.unitY ) );\r\n            tempVector.add(projY);\r\n          }\r\n          if ( scope.axis.search(\"Z\") != -1 ) {\r\n            projZ.multiplyScalar( point.dot( this.unitZ ) );\r\n            tempVector.add( projZ );\r\n          }\r\n          point.copy( tempVector );\r\n\r\n          point.applyMatrix4( tempMatrix.getInverse( parentRotationMatrix ) );\r\n\r\n          scope.object.position.copy( oldPosition );\r\n          scope.object.position.add( point );\r\n\r\n        }\r\n\r\n      } else if ( mode == \"scale\" ) {\r\n\r\n        point.sub( offset );\r\n        point.multiply(parentScale);\r\n\r\n        if ( scope.space == \"local\" ) {\r\n\r\n          if ( scope.axis == \"XYZ\") {\r\n\r\n            scale = 1 + ( ( point.y ) / 50 );\r\n\r\n            scope.object.scale.x = oldScale.x * scale;\r\n            scope.object.scale.y = oldScale.y * scale;\r\n            scope.object.scale.z = oldScale.z * scale;\r\n\r\n          } else {\r\n\r\n            point.applyMatrix4( tempMatrix.getInverse( worldRotationMatrix ) );\r\n\r\n            if ( scope.axis == \"X\" ) scope.object.scale.x = oldScale.x * ( 1 + point.x / 50 );\r\n            if ( scope.axis == \"Y\" ) scope.object.scale.y = oldScale.y * ( 1 + point.y / 50 );\r\n            if ( scope.axis == \"Z\" ) scope.object.scale.z = oldScale.z * ( 1 + point.z / 50 );\r\n\r\n          }\r\n\r\n        }\r\n\r\n      } else if ( mode == \"rotate\") {\r\n\r\n        point.sub( worldPosition );\r\n        point.multiply(parentScale);\r\n        tempVector.copy(offset).sub( worldPosition );\r\n        tempVector.multiply(parentScale);\r\n\r\n        if ( scope.axis == \"RE\" ) {\r\n\r\n          point.applyMatrix4( tempMatrix.getInverse( lookAtMatrix ) );\r\n          tempVector.applyMatrix4( tempMatrix.getInverse( lookAtMatrix ) );\r\n\r\n          rotation.set( Math.atan2( point.z, point.y ), Math.atan2( point.x, point.z ), Math.atan2( point.y, point.x ) );\r\n          offsetRotation.set( Math.atan2( tempVector.z, tempVector.y ), Math.atan2( tempVector.x, tempVector.z ), Math.atan2( tempVector.y, tempVector.x ) );\r\n\r\n          tempQuaternion.setFromRotationMatrix( tempMatrix.getInverse( parentRotationMatrix ) );\r\n\r\n          var rotz = rotation.z - offsetRotation.z;\r\n          if ( scope.snap !== null ) {\r\n            var rotsnap = Math.round( rotz / scope.snap ) * scope.snap;\r\n            if ( Math.abs(rotsnap-rotz) < scope.snapDelta ) {\r\n              rotz = rotsnap;\r\n            }\r\n          }\r\n          quaternionE.setFromAxisAngle( eye, rotz );\r\n          quaternionXYZ.setFromRotationMatrix( worldRotationMatrix );\r\n\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionE );\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionXYZ );\r\n\r\n          scope.object.quaternion.copy( tempQuaternion );\r\n\r\n        } else if ( scope.axis == \"RXYZE\" ) {\r\n\r\n          var tempAxis = point.clone().cross(tempVector).normalize(); // rotation axis\r\n\r\n          tempQuaternion.setFromRotationMatrix( tempMatrix.getInverse( parentRotationMatrix ) );\r\n\r\n          var rot = - point.clone().angleTo(tempVector);\r\n          if ( scope.snap !== null ) {\r\n            var rotsnap = Math.round( rot / scope.snap ) * scope.snap;\r\n            if ( Math.abs(rotsnap-rot) < scope.snapDelta ) {\r\n              rot = rotsnap;\r\n            }\r\n          }\r\n          quaternionX.setFromAxisAngle( tempAxis, rot );\r\n          quaternionXYZ.setFromRotationMatrix( worldRotationMatrix );\r\n\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionX );\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionXYZ );\r\n\r\n          scope.object.quaternion.copy( tempQuaternion );\r\n\r\n        } else if ( scope.space == \"local\" ) {\r\n\r\n          point.applyMatrix4( tempMatrix.getInverse( worldRotationMatrix ) );\r\n\r\n          tempVector.applyMatrix4( tempMatrix.getInverse( worldRotationMatrix ) );\r\n\r\n          var projx = point.dot(this.unitX), projy = point.dot(this.unitY), projz = point.dot(this.unitZ);\r\n          var tempx = tempVector.dot(this.unitX), tempy = tempVector.dot(this.unitY), tempz = tempVector.dot(this.unitZ);\r\n          rotation.set( Math.atan2( projz, projy ), Math.atan2( projx, projz ), Math.atan2( projy, projx ) );\r\n          offsetRotation.set( Math.atan2( tempz, tempy ), Math.atan2( tempx, tempz ), Math.atan2( tempy, tempx ) );\r\n\r\n          var rotx = rotation.x - offsetRotation.x;\r\n          var roty = rotation.y - offsetRotation.y;\r\n          var rotz = rotation.z - offsetRotation.z;\r\n          if ( scope.snap !== null ) {\r\n            if ( scope.axis.search(\"X\") != -1 ) {\r\n              var rotsnap = Math.round( rotx / scope.snap ) * scope.snap;\r\n              if ( Math.abs(rotsnap-rotx) < scope.snapDelta ) {\r\n                rotx = rotsnap;\r\n              }\r\n            }\r\n            if ( scope.axis.search(\"Y\") != -1 ) {\r\n              var rotsnap = Math.round( roty / scope.snap ) * scope.snap;\r\n              if ( Math.abs(rotsnap-roty) < scope.snapDelta ) {\r\n                roty = rotsnap;\r\n              }\r\n            }\r\n            if ( scope.axis.search(\"Z\") != -1 ) {\r\n              var rotsnap = Math.round( rotz / scope.snap ) * scope.snap;\r\n              if ( Math.abs(rotsnap-rotz) < scope.snapDelta ) {\r\n                rotz = rotsnap;\r\n              }\r\n            }\r\n          }\r\n          quaternionX.setFromAxisAngle( this.unitX, rotx );\r\n          quaternionY.setFromAxisAngle( this.unitY, roty );\r\n          quaternionZ.setFromAxisAngle( this.unitZ, rotz );\r\n          quaternionXYZ.setFromRotationMatrix( oldRotationMatrix );\r\n\r\n          if ( scope.axis == \"RX\" ) quaternionXYZ.multiplyQuaternions( quaternionXYZ, quaternionX );\r\n          if ( scope.axis == \"RY\" ) quaternionXYZ.multiplyQuaternions( quaternionXYZ, quaternionY );\r\n          if ( scope.axis == \"RZ\" ) quaternionXYZ.multiplyQuaternions( quaternionXYZ, quaternionZ );\r\n\r\n          scope.object.quaternion.copy( quaternionXYZ );\r\n\r\n        } else if ( scope.space == \"world\" ) {\r\n\r\n          var projx = point.dot(this.unitX), projy = point.dot(this.unitY), projz = point.dot(this.unitZ);\r\n          var tempx = tempVector.dot(this.unitX), tempy = tempVector.dot(this.unitY), tempz = tempVector.dot(this.unitZ);\r\n          rotation.set( Math.atan2( projz, projy ), Math.atan2( projx, projz ), Math.atan2( projy, projx ) );\r\n          offsetRotation.set( Math.atan2( tempz, tempy ), Math.atan2( tempx, tempz ), Math.atan2( tempy, tempx ) );\r\n\r\n          tempQuaternion.setFromRotationMatrix( tempMatrix.getInverse( parentRotationMatrix ) );\r\n\r\n          var rotx = rotation.x - offsetRotation.x;\r\n          var roty = rotation.y - offsetRotation.y;\r\n          var rotz = rotation.z - offsetRotation.z;\r\n          if ( scope.snap !== null ) {\r\n            if ( scope.axis.search(\"X\") != -1 ) {\r\n              var rotsnap = Math.round( rotx / scope.snap ) * scope.snap;\r\n              if ( Math.abs(rotsnap-rotx) < scope.snapDelta ) {\r\n                rotx = rotsnap;\r\n              }\r\n            }\r\n            if ( scope.axis.search(\"Y\") != -1 ) {\r\n              var rotsnap = Math.round( roty / scope.snap ) * scope.snap;\r\n              if ( Math.abs(rotsnap-roty) < scope.snapDelta ) {\r\n                roty = rotsnap;\r\n              }\r\n            }\r\n            if ( scope.axis.search(\"Z\") != -1 ) {\r\n              var rotsnap = Math.round( rotz / scope.snap ) * scope.snap;\r\n              if ( Math.abs(rotsnap-rotz) < scope.snapDelta ) {\r\n                rotz = rotsnap;\r\n              }\r\n            }\r\n          }\r\n          quaternionX.setFromAxisAngle( this.unitX, rotx );\r\n          quaternionY.setFromAxisAngle( this.unitY, roty );\r\n          quaternionZ.setFromAxisAngle( this.unitZ, rotz );\r\n          quaternionXYZ.setFromRotationMatrix( worldRotationMatrix );\r\n\r\n          if ( scope.axis == \"RX\" ) tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionX );\r\n          if ( scope.axis == \"RY\" ) tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionY );\r\n          if ( scope.axis == \"RZ\" ) tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionZ );\r\n\r\n          tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionXYZ );\r\n\r\n          scope.object.quaternion.copy( tempQuaternion );\r\n\r\n        }\r\n\r\n        // show rotation end line\r\n        if (_mode === \"transrotate\" ) {\r\n          scope.add( scope.endLine );\r\n          scope.add( scope.centerMark );\r\n        }\r\n\r\n      }\r\n\r\n      // update matrix\r\n      scope.object.matrixAutoUpdate = true;\r\n\r\n      scope.update(true);\r\n      scope.dispatchEvent( changeEvent );\r\n      scope.dispatchEvent( objectChangeEvent );\r\n\r\n      return planeIntersect? true : false;\r\n\r\n    }\r\n\r\n    this.onPointerUp = function( event ) {\r\n\r\n      if ( _dragging && ( scope.axis !== null ) ) {\r\n        mouseUpEvent.mode = _mode;\r\n        scope.dispatchEvent( mouseUpEvent )\r\n      }\r\n      _dragging = false;\r\n\r\n      this.gizmo[_mode].show();\r\n\r\n      this.updateUnitVectors();\r\n\r\n      // remove rotation start/end lines\r\n      if ( _mode === \"transrotate\" && this.gizmo[_mode].activeMode === \"rotate\" ) {\r\n        this.remove( this.endLine );\r\n        this.remove( this.centerMark );\r\n        this.parent.remove( this.centerLine );\r\n        this.parent.remove( this.startLine );\r\n        this.parent.remove( this.ticks[this.axis] );\r\n      }\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    function intersectObjects( pointer, objects ) {\r\n\r\n      var rect = domElement.getBoundingClientRect();\r\n      var x = ( ( pointer.clientX - rect.left ) / rect.width ) * 2 - 1;\r\n      var y = - ( ( pointer.clientY - rect.top ) / rect.height ) * 2 + 1;\r\n\r\n      if ( camera.isPerspective ) {\r\n        pointerVector.set( x, y, 0.5 );\r\n        pointerVector.unproject( camera );\r\n        ray.set( camera.position, pointerVector.sub( camera.position ).normalize() );\r\n      } else {\r\n        pointerVector.set( x, y, -1 );\r\n        pointerVector.unproject( camera );\r\n        pointerDir.set( 0, 0, -1 );\r\n        ray.set( pointerVector, pointerDir.transformDirection( camera.matrixWorld ) );\r\n      }\r\n\r\n      var intersections = ray.intersectObjects( objects, true );\r\n      return intersections[0] ? intersections[0] : false;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  THREE.TransformControls.prototype = Object.create( THREE.Object3D.prototype );\r\n})()\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/TransformGizmos.js","/////////////////////////////////////////////////////////////////////\r\n// Viewing.Extension.CSSTVExtension\r\n// by Philippe Leefsma, April 2016\r\n//\r\n/////////////////////////////////////////////////////////////////////\r\nimport TranslateTool from './Viewing.Tool.Translate'\r\nimport ExtensionBase from 'Viewer.ExtensionBase'\r\nimport RotateTool from './Viewing.Tool.Rotate'\r\nimport ViewerToolkit from 'Viewer.Toolkit'\r\nimport Stopwatch from 'Stopwatch'\r\nimport easing from 'easing-js'\r\n\r\nclass TransformExtension extends ExtensionBase {\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  // Class constructor\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  constructor (viewer, options = {}) {\r\n\r\n    super (viewer, options)\r\n\r\n    this.translateTool = new TranslateTool(viewer)\r\n\r\n    this.rotateTool = new RotateTool(viewer)\r\n\r\n    this.transformedFragIdMap = {}\r\n\r\n    this.translateTool.on('selection', (selection) => {\r\n\r\n      const translateSelection = selection\r\n        ? Object.assign({}, selection, {\r\n            type: 'translate'\r\n          })\r\n        : null\r\n\r\n      this.emit('selection', translateSelection)\r\n    })\r\n\r\n    this.translateTool.on('translate', (data) => {\r\n\r\n      data.fragIds.forEach((fragId) => {\r\n\r\n        this.transformedFragIdMap[fragId] = true\r\n      })\r\n\r\n      this.emit('transform', {\r\n        transform: {\r\n          translation: data.translation\r\n        },\r\n        fragIds: data.fragIds,\r\n        model: data.model,\r\n        dbIds: data.dbIds\r\n      })\r\n    })\r\n\r\n    this.translateTool.on('deactivate', () => {\r\n\r\n      this._txControl.container.classList.remove('active')\r\n      this._comboCtrl.container.classList.remove('active')\r\n\r\n      this.emit('deactivate')\r\n    })\r\n\r\n    this.rotateTool.on('selection', (selection) => {\r\n\r\n      const rotateSelection = selection\r\n        ? Object.assign({}, selection, {\r\n            type: 'rotate'\r\n          })\r\n        : null\r\n\r\n      this.emit('selection', rotateSelection)\r\n    })\r\n\r\n    this.rotateTool.on('rotate', (data) => {\r\n\r\n      data.fragIds.forEach((fragId) => {\r\n\r\n        this.transformedFragIdMap[fragId] = true\r\n      })\r\n\r\n      this.emit('transform', {\r\n        transform: {\r\n          rotation: data.rotation\r\n        },\r\n        fragIds: data.fragIds,\r\n        model: data.model,\r\n        dbIds: data.dbIds\r\n      })\r\n    })\r\n\r\n    this.rotateTool.on('deactivate', () => {\r\n\r\n      this._rxControl.container.classList.remove('active')\r\n      this._comboCtrl.container.classList.remove('active')\r\n\r\n      this.emit('deactivate')\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  // Extension Id\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  static get ExtensionId () {\r\n\r\n    return 'Viewing.Extension.Transform'\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  // Load callback\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  load () {\r\n\r\n    this._txControl = ViewerToolkit.createButton(\r\n      'toolbar-translate',\r\n      'fa fa-arrows-alt',\r\n      'Translate Tool', () => {\r\n\r\n        if (this.translateTool.active) {\r\n\r\n          this.translateTool.deactivate()\r\n          this._txControl.container.classList.remove('active')\r\n          this._comboCtrl.container.classList.remove('active')\r\n\r\n        } else {\r\n\r\n          this.translate()\r\n        }\r\n      })\r\n\r\n    this._rxControl = ViewerToolkit.createButton(\r\n      'toolbar-rotate',\r\n      'fa fa-refresh',\r\n      'Rotate Tool', () => {\r\n\r\n        if (this.rotateTool.active) {\r\n\r\n          this.rotateTool.deactivate()\r\n          this._rxControl.container.classList.remove('active')\r\n          this._comboCtrl.container.classList.remove('active')\r\n\r\n        } else {\r\n\r\n          this.rotate()\r\n        }\r\n      })\r\n\r\n    this.parentControl = this._options.parentControl\r\n\r\n    if (!this.parentControl && !this._options.hideControls) {\r\n\r\n      var viewerToolbar = this._viewer.getToolbar(true)\r\n\r\n      this.parentControl = new Autodesk.Viewing.UI.ControlGroup(\r\n        'transform')\r\n\r\n      viewerToolbar.addControl(this.parentControl)\r\n    }\r\n\r\n    this._comboCtrl = new Autodesk.Viewing.UI.ComboButton(\r\n      'toolbar-transform')\r\n\r\n    this._comboCtrl.setToolTip('Transform Tools')\r\n\r\n    this._comboCtrl.icon.style.fontSize = '24px'\r\n    this._comboCtrl.icon.style.transform = 'rotateY(180Deg)'\r\n\r\n    this._comboCtrl.icon.className =\r\n      'glyphicon glyphicon-wrench'\r\n\r\n    this._comboCtrl.addControl(this._txControl)\r\n    this._comboCtrl.addControl(this._rxControl)\r\n\r\n    var openCombo = this._comboCtrl.onClick\r\n\r\n    this._comboCtrl.onClick = (e) => {\r\n\r\n      if(this._comboCtrl.container.classList.contains('active')) {\r\n\r\n        this.deactivate ()\r\n\r\n      } else {\r\n\r\n        openCombo()\r\n      }\r\n    }\r\n\r\n    if(!this._options.hideControls) {\r\n\r\n      this.parentControl.addControl(this._comboCtrl)\r\n    }\r\n\r\n    console.log('Viewing.Extension.Transform loaded')\r\n\r\n    return true\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  // Unload callback\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  unload () {\r\n\r\n    this.parentControl.removeControl(\r\n      this._comboCtrl)\r\n\r\n    this.translateTool.deactivate()\r\n\r\n    this.rotateTool.deactivate()\r\n\r\n    console.log('Viewing.Extension.Transform unloaded')\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  translate () {\r\n\r\n    this.translateTool.activate()\r\n    this._txControl.container.classList.add('active')\r\n\r\n    this.rotateTool.deactivate()\r\n    this._rxControl.container.classList.remove('active')\r\n\r\n    this._comboCtrl.container.classList.add('active')\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  rotate () {\r\n\r\n    this.rotateTool.activate()\r\n    this._rxControl.container.classList.add('active')\r\n\r\n    this.translateTool.deactivate()\r\n    this._txControl.container.classList.remove('active')\r\n\r\n    this._comboCtrl.container.classList.add('active')\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  deactivate () {\r\n\r\n    this._txControl.container.classList.remove('active')\r\n    this._rxControl.container.classList.remove('active')\r\n\r\n    this._comboCtrl.container.classList.remove('active')\r\n\r\n    this.translateTool.deactivate()\r\n    this.rotateTool.deactivate()\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  setFullTransform (fullTransform) {\r\n\r\n    this.translateTool.fullTransform = fullTransform\r\n\r\n    this.rotateTool.fullTransform = fullTransform\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  pickPosition () {\r\n\r\n    this.translateTool.onPick()\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  clearSelection () {\r\n\r\n    this.translateTool.clearSelection()\r\n\r\n    this.rotateTool.clearSelection()\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //  From viewer.getState:\r\n  //  Allow extensions to inject their state data\r\n  //\r\n  //  for (var extensionName in viewer.loadedExtensions) {\r\n  //    viewer.loadedExtensions[extensionName].getState(\r\n  //      viewerState);\r\n  //  }\r\n  /////////////////////////////////////////////////////////////////\r\n  getState (viewerState) {\r\n\r\n    this.currentExplodeScale =\r\n      this.currentExplodeScale ||\r\n      this._viewer.getExplodeScale()\r\n\r\n    viewerState.explodeScale = this.currentExplodeScale\r\n\r\n    viewerState.transforms = {}\r\n\r\n    for (let fragId in this.transformedFragIdMap) {\r\n\r\n      const fragProxy = this._viewer.impl.getFragmentProxy(\r\n        this._viewer.model,\r\n        fragId)\r\n\r\n      fragProxy.getAnimTransform()\r\n\r\n      viewerState.transforms[fragId] = {\r\n        quaternion: fragProxy.quaternion,\r\n        position: fragProxy.position\r\n      }\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //    From viewer.restoreState:\r\n  //    Allow extensions to restore their data\r\n  //\r\n  //    for (var extensionName in viewer.loadedExtensions) {\r\n  //      viewer.loadedExtensions[extensionName].restoreState(\r\n  //        viewerState, immediate);\r\n  //    }\r\n  /////////////////////////////////////////////////////////////////\r\n  restoreState (viewerState, immediate) {\r\n\r\n    this.translateTool.clearSelection()\r\n\r\n    this.rotateTool.clearSelection()\r\n\r\n    if (viewerState.transforms) {\r\n\r\n      //this.restoreTransform(viewerState)\r\n\r\n      const period = 1.8\r\n\r\n      const easingFunc = (t) => {\r\n        //b: begging value, c: change in value, d: duration\r\n        return easing.easeInOutExpo(t, 0, 1, period * 0.7)\r\n      }\r\n\r\n      this.animateTransform(\r\n        viewerState, easingFunc, period).then(() => {\r\n\r\n          this.currentExplodeScale =\r\n            viewerState.explodeScale\r\n        })\r\n\r\n      this.transformedFragIdMap = Object.assign({},\r\n        viewerState.transforms)\r\n\r\n      this.viewer.impl.sceneUpdated(true)\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  restoreTransform (targetState) {\r\n\r\n    const currentFragIds = Object.keys(\r\n      this.transformedFragIdMap)\r\n\r\n    const targetFragIds = Object.keys(\r\n      targetState.transforms)\r\n\r\n    const fullFragIds = [\r\n      ...currentFragIds,\r\n      ...targetFragIds\r\n    ]\r\n\r\n    fullFragIds.forEach((fragId) => {\r\n\r\n      const transform = targetState.transforms[ fragId ] || {\r\n          quaternion: { _x: 0, _y: 0, _z: 0, _w: 1 },\r\n          position: { x: 0, y: 0, z: 0 }\r\n        }\r\n\r\n      const fragProxy = viewer.impl.getFragmentProxy(\r\n        this._viewer.model,\r\n        fragId)\r\n\r\n      fragProxy.getAnimTransform()\r\n\r\n      fragProxy.position.x = transform.position.x\r\n      fragProxy.position.y = transform.position.y\r\n      fragProxy.position.z = transform.position.z\r\n\r\n      fragProxy.quaternion._x = transform.quaternion._x\r\n      fragProxy.quaternion._y = transform.quaternion._y\r\n      fragProxy.quaternion._z = transform.quaternion._z\r\n      fragProxy.quaternion._w = transform.quaternion._w\r\n\r\n      fragProxy.updateAnimTransform()\r\n    })\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  animateTransform (targetState, easing, period = 2.0) {\r\n\r\n    return new Promise (async(resolve, reject) => {\r\n\r\n      const viewer = this._viewer\r\n\r\n      const currentFragIds = Object.keys(\r\n        this.transformedFragIdMap)\r\n\r\n      const targetFragIds = Object.keys(\r\n        targetState.transforms)\r\n\r\n      const fullFragIds = [\r\n        ...currentFragIds,\r\n        ...targetFragIds\r\n      ]\r\n\r\n      const fragProxyTasks = fullFragIds.map((fragId) => {\r\n\r\n        const fragProxy = viewer.impl.getFragmentProxy(\r\n          viewer.model,\r\n          fragId)\r\n\r\n        fragProxy.getAnimTransform()\r\n\r\n        const targetTransform = targetState.transforms[fragId] || {\r\n            quaternion: { _x: 0, _y:0, _z:0, _w:1 },\r\n            position: { x: 0, y: 0, z: 0 }\r\n          }\r\n\r\n        fragProxy.step = {\r\n\r\n          dx: (targetTransform.position.x - fragProxy.position.x) / period,\r\n          dy: (targetTransform.position.y - fragProxy.position.y) / period,\r\n          dz: (targetTransform.position.z - fragProxy.position.z) / period,\r\n\r\n          dQx: (targetTransform.quaternion._x - fragProxy.quaternion._x) / period,\r\n          dQy: (targetTransform.quaternion._y - fragProxy.quaternion._y) / period,\r\n          dQz: (targetTransform.quaternion._z - fragProxy.quaternion._z) / period,\r\n          dQw: (targetTransform.quaternion._w - fragProxy.quaternion._w) / period\r\n        }\r\n\r\n        fragProxy.initialTransform = {\r\n          quaternion: {\r\n            _x: fragProxy.quaternion._x,\r\n            _y: fragProxy.quaternion._y,\r\n            _z: fragProxy.quaternion._z,\r\n            _w: fragProxy.quaternion._w\r\n          },\r\n          position: {\r\n            x: fragProxy.position.x,\r\n            y: fragProxy.position.y,\r\n            z: fragProxy.position.z\r\n          }\r\n        }\r\n\r\n        fragProxy.targetTransform = targetTransform\r\n\r\n        return fragProxy\r\n      });\r\n\r\n      const fragProxies = await Promise.all(fragProxyTasks)\r\n\r\n      // Create all fragment animation tasks\r\n      const animationTasks = fragProxies.map((fragProxy) => {\r\n\r\n        return {\r\n\r\n          step: (dt) => {\r\n\r\n            //fragProxy.quaternion.slerp(\r\n            //  fragProxy.transform.quaternion,\r\n            //  dt/tStep)\r\n\r\n            fragProxy.quaternion._x += fragProxy.step.dQx * dt\r\n            fragProxy.quaternion._y += fragProxy.step.dQy * dt\r\n            fragProxy.quaternion._z += fragProxy.step.dQz * dt\r\n            fragProxy.quaternion._w += fragProxy.step.dQw * dt\r\n\r\n            fragProxy.position.x += fragProxy.step.dx * dt\r\n            fragProxy.position.y += fragProxy.step.dy * dt\r\n            fragProxy.position.z += fragProxy.step.dz * dt\r\n\r\n            fragProxy.updateAnimTransform()\r\n          },\r\n\r\n          ease: (t) => {\r\n\r\n            //fragProxy.quaternion.slerp(\r\n            //  fragProxy.transform.quaternion,\r\n            //  dt/tStep)\r\n\r\n            const eased = easing(t/period)\r\n\r\n            const _targetQuat = fragProxy.targetTransform.quaternion\r\n            const _initQuat = fragProxy.initialTransform.quaternion\r\n\r\n            const initQuat = new THREE.Quaternion(\r\n              _initQuat._x,\r\n              _initQuat._y,\r\n              _initQuat._z,\r\n              _initQuat._w)\r\n\r\n            const targetQuat = new THREE.Quaternion(\r\n              _targetQuat._x,\r\n              _targetQuat._y,\r\n              _targetQuat._z,\r\n              _targetQuat._w)\r\n\r\n            initQuat.slerp(targetQuat, eased)\r\n\r\n            fragProxy.quaternion._x = initQuat.x\r\n            fragProxy.quaternion._y = initQuat.y\r\n            fragProxy.quaternion._z = initQuat.z\r\n            fragProxy.quaternion._w = initQuat.w\r\n\r\n            //fragProxy.quaternion._x = eased * targetQuat._x + (1 - eased) * initQuat._x\r\n            //fragProxy.quaternion._y = eased * targetQuat._y + (1 - eased) * initQuat._y\r\n            //fragProxy.quaternion._z = eased * targetQuat._z + (1 - eased) * initQuat._z\r\n            //fragProxy.quaternion._w = eased * targetQuat._z + (1 - eased) * initQuat._z\r\n\r\n            const targetPos = fragProxy.targetTransform.position\r\n            const initPos = fragProxy.initialTransform.position\r\n\r\n            fragProxy.position.x = eased * targetPos.x + (1 - eased) * initPos.x\r\n            fragProxy.position.y = eased * targetPos.y + (1 - eased) * initPos.y\r\n            fragProxy.position.z = eased * targetPos.z + (1 - eased) * initPos.z\r\n\r\n            fragProxy.updateAnimTransform()\r\n          },\r\n\r\n          finalStep: () => {\r\n\r\n            fragProxy.quaternion._x = fragProxy.targetTransform.quaternion._x\r\n            fragProxy.quaternion._y = fragProxy.targetTransform.quaternion._y\r\n            fragProxy.quaternion._z = fragProxy.targetTransform.quaternion._z\r\n            fragProxy.quaternion._w = fragProxy.targetTransform.quaternion._w\r\n\r\n            fragProxy.position.copy(fragProxy.targetTransform.position)\r\n\r\n            fragProxy.updateAnimTransform()\r\n          }\r\n        }\r\n      })\r\n\r\n      // create explode animation task\r\n\r\n      let scale = parseFloat(this.currentExplodeScale)\r\n\r\n      const targetScale = parseFloat(\r\n        targetState.explodeScale)\r\n\r\n      if (targetScale != scale) {\r\n\r\n        var scaleStep = (targetScale - scale) / period\r\n\r\n        animationTasks.push({\r\n\r\n          step: (dt) => {\r\n\r\n            scale += scaleStep * dt\r\n\r\n            ViewerToolkit.selectiveExplode(\r\n              viewer,\r\n              scale,\r\n              fullFragIds)\r\n          },\r\n\r\n          ease: (t) => {\r\n\r\n            const eased = easing(t/period)\r\n\r\n            const easedScale = scale +\r\n              eased * (targetScale - scale)\r\n\r\n            ViewerToolkit.selectiveExplode(\r\n              viewer,\r\n              easedScale,\r\n              fullFragIds)\r\n          },\r\n\r\n          finalStep: () => {\r\n\r\n            ViewerToolkit.selectiveExplode(\r\n              viewer,\r\n              targetScale,\r\n              fullFragIds)\r\n\r\n            viewer.explodeSlider.value = targetScale\r\n          }\r\n        })\r\n      }\r\n\r\n\r\n      let animationId = 0\r\n      let elapsed = 0\r\n\r\n      const stopwatch = new Stopwatch()\r\n\r\n      const animateTransformStep = () => {\r\n\r\n        const dt = stopwatch.getElapsedMs() * 0.001\r\n\r\n        elapsed += dt\r\n\r\n        if (elapsed < period) {\r\n\r\n          animationTasks.forEach((task) => {\r\n\r\n            task.ease(elapsed)\r\n          })\r\n\r\n          animationId = requestAnimationFrame(\r\n            animateTransformStep)\r\n\r\n        } else {\r\n\r\n          //end of animation\r\n          animationTasks.forEach((task) => {\r\n\r\n            task.finalStep()\r\n          })\r\n\r\n          cancelAnimationFrame(animationId)\r\n\r\n          viewer.autocam.shotParams.duration = 1.0\r\n        }\r\n\r\n        viewer.impl.sceneUpdated(true)\r\n\r\n        resolve()\r\n      }\r\n\r\n      viewer.autocam.shotParams.duration = period\r\n\r\n      animationId = requestAnimationFrame(\r\n        animateTransformStep)\r\n    })\r\n  }\r\n}\r\n\r\nAutodesk.Viewing.theExtensionManager.registerExtension(\r\n  TransformExtension.ExtensionId,\r\n  TransformExtension)\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/Viewing.Extension.Transform.js","import EventsEmitter from 'EventsEmitter'\r\n\r\nexport default class RotateTool extends EventsEmitter {\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  // Class constructor\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  constructor (viewer) {\r\n\r\n    super()\r\n\r\n    this.keys = {}\r\n\r\n    this.active = false\r\n\r\n    this.viewer = viewer\r\n\r\n    this.fullTransform = false\r\n\r\n    this.viewer.toolController.registerTool(this)\r\n\r\n    this.onAggregateSelectionChangedHandler = (e) => {\r\n\r\n      this.onAggregateSelectionChanged(e)\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  getNames () {\r\n\r\n    return ['Viewing.Tool.Rotate']\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  getName () {\r\n\r\n    return 'Viewing.Tool.Rotate'\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////\r\n  // activate tool\r\n  //\r\n  ///////////////////////////////////////////////////////////////////\r\n  activate () {\r\n\r\n    if (!this.active) {\r\n\r\n      this.active = true\r\n\r\n      this.viewer.toolController.activateTool(\r\n        this.getName())\r\n\r\n      this.viewer.addEventListener(\r\n        Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,\r\n        this.onAggregateSelectionChangedHandler)\r\n\r\n      this.emit('activate')\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // deactivate tool\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  deactivate () {\r\n\r\n    if (this.active) {\r\n\r\n      this.active = false\r\n\r\n      this.viewer.toolController.deactivateTool(\r\n        this.getName())\r\n\r\n      if (this.rotateControl) {\r\n\r\n        this.rotateControl.remove()\r\n        this.rotateControl = null\r\n      }\r\n\r\n      this.viewer.removeEventListener(\r\n        Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,\r\n        this.onAggregateSelectionChangedHandler)\r\n\r\n      this.emit('deactivate')\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Component Selection Handler\r\n  // (use Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT instead of\r\n  //  Autodesk.Viewing.SELECTION_CHANGED_EVENT - deprecated )\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  onAggregateSelectionChanged (event) {\r\n\r\n    if (this.rotateControl && this.rotateControl.engaged) {\r\n\r\n      this.rotateControl.engaged = false\r\n\r\n      this.viewer.select(this.selection.dbIdArray)\r\n\r\n      return\r\n    }\r\n\r\n    if (event.selections.length) {\r\n\r\n      var selection = event.selections[0]\r\n\r\n      this.selection = selection\r\n\r\n      if (this.fullTransform) {\r\n\r\n        this.selection.fragIdsArray = []\r\n\r\n        var fragCount = selection.model.getFragmentList().\r\n          fragments.fragId2dbId.length\r\n\r\n        for (var fragId = 0; fragId < fragCount; ++fragId) {\r\n\r\n          this.selection.fragIdsArray.push(fragId)\r\n        }\r\n\r\n        this.selection.dbIdArray = []\r\n\r\n        var instanceTree = selection.model.getData().instanceTree\r\n\r\n        var rootId = instanceTree.getRootId()\r\n\r\n        this.selection.dbIdArray.push(rootId)\r\n      }\r\n\r\n      this.drawControl()\r\n\r\n      this.viewer.fitToView(this.selection.dbIdArray)\r\n\r\n      this.emit('selection', selection)\r\n\r\n    } else {\r\n\r\n      this.clearSelection()\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Selection cleared\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  clearSelection () {\r\n\r\n    this.selection = null\r\n\r\n    if (this.rotateControl) {\r\n\r\n      this.rotateControl.remove()\r\n\r\n      this.rotateControl = null\r\n\r\n      this.viewer.impl.sceneUpdated(true)\r\n    }\r\n\r\n    this.emit('selection', null)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Draw rotate control\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  drawControl () {\r\n\r\n    var bBox = this.getWorldBoundingBox(\r\n      this.selection.fragIdsArray,\r\n      this.selection.model.getFragmentList())\r\n\r\n    this.center = new THREE.Vector3(\r\n      (bBox.min.x + bBox.max.x) / 2,\r\n      (bBox.min.y + bBox.max.y) / 2,\r\n      (bBox.min.z + bBox.max.z) / 2)\r\n\r\n    var size = Math.max(\r\n        bBox.max.x - bBox.min.x,\r\n        bBox.max.y - bBox.min.y,\r\n        bBox.max.z - bBox.min.z) * 0.8\r\n\r\n    if (this.rotateControl) {\r\n\r\n      this.rotateControl.remove()\r\n    }\r\n\r\n    this.rotateControl = new RotateControl(\r\n      this.viewer, this.center, size)\r\n\r\n    this.rotateControl.on('rotate', (data) => {\r\n\r\n      this.rotateFragments(\r\n        this.selection.model,\r\n        this.selection.fragIdsArray,\r\n        data.axis,\r\n        data.angle,\r\n        this.center)\r\n\r\n      this.viewer.impl.sceneUpdated(true)\r\n    })\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleButtonDown (event, button) {\r\n\r\n    if (this.rotateControl) {\r\n\r\n      if (this.rotateControl.onPointerDown(event)) {\r\n\r\n        return true\r\n      }\r\n    }\r\n\r\n    if (button === 0 && this.keys.Control) {\r\n\r\n      this.isDragging = true\r\n\r\n      this.mousePos = {\r\n        x: event.clientX,\r\n        y: event.clientY\r\n      }\r\n\r\n      return true\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleButtonUp (event, button) {\r\n\r\n    if (this.rotateControl) {\r\n\r\n      this.rotateControl.onPointerUp(event)\r\n    }\r\n\r\n    if (button === 0) {\r\n\r\n      this.isDragging = false\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleMouseMove (event) {\r\n\r\n    if (this.rotateControl) {\r\n\r\n      this.rotateControl.onPointerHover(event)\r\n    }\r\n\r\n    if (this.isDragging) {\r\n\r\n      if (this.selection) {\r\n\r\n        var offset = {\r\n          x: this.mousePos.x - event.clientX,\r\n          y: event.clientY - this.mousePos.y\r\n        }\r\n\r\n        this.mousePos = {\r\n          x: event.clientX,\r\n          y: event.clientY\r\n        }\r\n\r\n        var angle = Math.sqrt(\r\n          offset.x * offset.x +\r\n          offset.y * offset.y)\r\n\r\n        var sidewaysDirection = new THREE.Vector3()\r\n        var moveDirection = new THREE.Vector3()\r\n        var eyeDirection = new THREE.Vector3()\r\n        var upDirection = new THREE.Vector3()\r\n        var camera = this.viewer.getCamera()\r\n        var axis = new THREE.Vector3()\r\n        var eye = new THREE.Vector3()\r\n\r\n        eye.copy(camera.position).sub(camera.target)\r\n\r\n        eyeDirection.copy(eye).normalize()\r\n\r\n        upDirection.copy(camera.up).normalize()\r\n\r\n        sidewaysDirection.crossVectors(\r\n          upDirection, eyeDirection).normalize()\r\n\r\n        upDirection.setLength(offset.y)\r\n\r\n        sidewaysDirection.setLength(offset.x)\r\n\r\n        moveDirection.copy(\r\n          upDirection.add(\r\n            sidewaysDirection))\r\n\r\n        axis.crossVectors(moveDirection, eye).normalize()\r\n\r\n        this.rotateFragments(\r\n          this.selection.model,\r\n          this.selection.fragIdsArray,\r\n          axis, angle * Math.PI / 180,\r\n          this.center)\r\n\r\n        this.viewer.impl.sceneUpdated(true)\r\n      }\r\n\r\n      return true\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleKeyDown (event, keyCode) {\r\n\r\n    this.keys[event.key] = true\r\n\r\n    if (keyCode === 27) { //ESC\r\n\r\n      this.deactivate()\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleKeyUp (event, keyCode) {\r\n\r\n    this.keys[event.key] = false\r\n\r\n    return false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Rotate selected fragments\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  rotateFragments (model, fragIdsArray, axis, angle, center) {\r\n\r\n    var quaternion = new THREE.Quaternion()\r\n\r\n    quaternion.setFromAxisAngle(axis, angle)\r\n\r\n    fragIdsArray.forEach((fragId, idx) => {\r\n\r\n      var fragProxy = this.viewer.impl.getFragmentProxy(\r\n        model, fragId)\r\n\r\n      fragProxy.getAnimTransform()\r\n\r\n      var position = new THREE.Vector3(\r\n        fragProxy.position.x - center.x,\r\n        fragProxy.position.y - center.y,\r\n        fragProxy.position.z - center.z)\r\n\r\n      position.applyQuaternion(quaternion)\r\n\r\n      position.add(center)\r\n\r\n      fragProxy.position = position\r\n\r\n      fragProxy.quaternion.multiplyQuaternions(\r\n        quaternion, fragProxy.quaternion)\r\n\r\n      if (idx === 0) {\r\n\r\n        var euler = new THREE.Euler()\r\n\r\n        euler.setFromQuaternion(\r\n          fragProxy.quaternion, 0)\r\n\r\n        this.emit('rotate', {\r\n          dbIds: this.selection.dbIdArray,\r\n          fragIds: fragIdsArray,\r\n          rotation: euler,\r\n          model\r\n        })\r\n      }\r\n\r\n      fragProxy.updateAnimTransform()\r\n    })\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // returns bounding box as it appears in the viewer\r\n  // (transformations could be applied)\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  getWorldBoundingBox (fragIds, fragList) {\r\n\r\n    var fragbBox = new THREE.Box3()\r\n    var nodebBox = new THREE.Box3()\r\n\r\n    fragIds.forEach((fragId) => {\r\n\r\n      fragList.getWorldBounds(fragId, fragbBox)\r\n      nodebBox.union(fragbBox)\r\n    })\r\n\r\n    return nodebBox\r\n  }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// RotateControl Class\r\n//\r\n///////////////////////////////////////////////////////////////////////////////\r\nclass RotateControl extends EventsEmitter {\r\n\r\n  constructor (viewer, center, size) {\r\n\r\n    super()\r\n\r\n    this.engaged = false\r\n\r\n    this.overlayScene = 'rotateControlScene'\r\n    this.domElement = viewer.impl.canvas\r\n    this.camera = viewer.impl.camera\r\n    this.viewer = viewer\r\n    this.center = center\r\n    this.size = size\r\n    this.gizmos = []\r\n\r\n    this.viewer.impl.createOverlayScene(\r\n      this.overlayScene)\r\n\r\n    this.createAxis(\r\n      center, new THREE.Vector3(1, 0, 0),\r\n      size * 0.85, 0xFF0000)\r\n\r\n    this.createAxis(\r\n      center, new THREE.Vector3(0, 1, 0),\r\n      size * 0.85, 0x00FF00)\r\n\r\n    this.createAxis(\r\n      center, new THREE.Vector3(0, 0, 1),\r\n      size * 0.85, 0x0000FF)\r\n\r\n    // World UP = Y\r\n\r\n    if (this.camera.worldup.y) {\r\n\r\n      this.gizmos.push(this.createGizmo(\r\n        center,\r\n        new THREE.Euler(0, Math.PI / 2, 0),\r\n        size * 0.0045,\r\n        size * 0.8, 0xFF0000,\r\n        Math.PI,\r\n        new THREE.Vector3(1, 0, 0)))\r\n\r\n      this.gizmos.push(this.createGizmo(\r\n        center,\r\n        new THREE.Euler(Math.PI / 2, 0, 0),\r\n        size * 0.0045,\r\n        size * 0.8, 0x00FF00,\r\n        2 * Math.PI,\r\n        new THREE.Vector3(0, 1, 0)))\r\n\r\n      this.gizmos.push(this.createGizmo(\r\n        center,\r\n        new THREE.Euler(0, 0, 0),\r\n        size * 0.0045,\r\n        size * 0.8, 0x0000FF,\r\n        Math.PI,\r\n        new THREE.Vector3(0, 0, 1)))\r\n\r\n    } else {\r\n\r\n      // World UP = Z\r\n\r\n      this.gizmos.push(this.createGizmo(\r\n        center,\r\n        new THREE.Euler(Math.PI / 2, Math.PI / 2, 0),\r\n        size * 0.0045,\r\n        size * 0.8, 0xFF0000,\r\n        Math.PI,\r\n        new THREE.Vector3(1, 0, 0)))\r\n\r\n      this.gizmos.push(this.createGizmo(\r\n        center,\r\n        new THREE.Euler(Math.PI / 2, 0, 0),\r\n        size * 0.0045,\r\n        size * 0.8, 0x00FF00,\r\n        Math.PI,\r\n        new THREE.Vector3(0, 1, 0)))\r\n\r\n      this.gizmos.push(this.createGizmo(\r\n        center,\r\n        new THREE.Euler(0, 0, 0),\r\n        size * 0.0045,\r\n        size * 0.8, 0x0000FF,\r\n        2 * Math.PI,\r\n        new THREE.Vector3(0, 0, 1)))\r\n    }\r\n\r\n    this.picker = this.createSphere(\r\n      size * 0.02)\r\n\r\n    var material = new THREE.LineBasicMaterial({\r\n      color: 0xFFFF00,\r\n      linewidth: 1,\r\n      depthTest: false,\r\n      depthWrite: false,\r\n      transparent: true\r\n    })\r\n\r\n    this.angleLine =\r\n      this.createLine(\r\n        this.center,\r\n        this.center,\r\n        material)\r\n\r\n    viewer.impl.sceneUpdated(true)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Draw a line\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  createLine (start, end, material) {\r\n\r\n    var geometry = new THREE.Geometry()\r\n\r\n    geometry.vertices.push(new THREE.Vector3(\r\n      start.x, start.y, start.z))\r\n\r\n    geometry.vertices.push(new THREE.Vector3(\r\n      end.x, end.y, end.z))\r\n\r\n    var line = new THREE.Line(geometry, material)\r\n\r\n    this.viewer.impl.addOverlay(\r\n      this.overlayScene, line)\r\n\r\n    return line\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Draw a cone\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  createCone (start, dir, length, material) {\r\n\r\n    dir.normalize()\r\n\r\n    var end = {\r\n      x: start.x + dir.x * length,\r\n      y: start.y + dir.y * length,\r\n      z: start.z + dir.z * length\r\n    }\r\n\r\n    var orientation = new THREE.Matrix4()\r\n\r\n    orientation.lookAt(\r\n      start,\r\n      end,\r\n      new THREE.Object3D().up)\r\n\r\n    var matrix = new THREE.Matrix4()\r\n\r\n    matrix.set(\r\n      1, 0, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, -1, 0, 0,\r\n      0, 0, 0, 1)\r\n\r\n    orientation.multiply(matrix)\r\n\r\n    var geometry = new THREE.CylinderGeometry(\r\n      0, length * 0.2, length, 128, 1)\r\n\r\n    var cone = new THREE.Mesh(geometry, material)\r\n\r\n    cone.applyMatrix(orientation)\r\n\r\n    cone.position.x = start.x + dir.x * length / 2\r\n    cone.position.y = start.y + dir.y * length / 2\r\n    cone.position.z = start.z + dir.z * length / 2\r\n\r\n    this.viewer.impl.addOverlay(\r\n      this.overlayScene, cone)\r\n\r\n    return cone\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Draw one axis\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  createAxis (start, dir, size, color) {\r\n\r\n    var end = {\r\n      x: start.x + dir.x * size,\r\n      y: start.y + dir.y * size,\r\n      z: start.z + dir.z * size\r\n    }\r\n\r\n    var material = new THREE.LineBasicMaterial({\r\n      color: color,\r\n      linewidth: 3,\r\n      depthTest: false,\r\n      depthWrite: false,\r\n      transparent: true\r\n    })\r\n\r\n    this.createLine(\r\n      start, end, material)\r\n\r\n    this.createCone(\r\n      end, dir, size * 0.1, material)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Draw a rotate gizmo\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  createGizmo (center, euler, size, radius, color, range, axis) {\r\n\r\n    var material = new GizmoMaterial({\r\n      color: color\r\n    })\r\n\r\n    var subMaterial = new GizmoMaterial({\r\n      color: color\r\n    })\r\n\r\n    var torusGizmo = new THREE.Mesh(\r\n      new THREE.TorusGeometry(\r\n        radius, size, 64, 64, range),\r\n      material)\r\n\r\n    var subTorus = new THREE.Mesh(\r\n      new THREE.TorusGeometry(\r\n        radius, size, 64, 64, 2 * Math.PI),\r\n      subMaterial)\r\n\r\n    subTorus.material.highlight(true)\r\n\r\n    var transform = new THREE.Matrix4()\r\n\r\n    var q = new THREE.Quaternion()\r\n\r\n    q.setFromEuler(euler)\r\n\r\n    var s = new THREE.Vector3(1, 1, 1)\r\n\r\n    transform.compose(center, q, s)\r\n\r\n    torusGizmo.applyMatrix(transform)\r\n\r\n    subTorus.applyMatrix(transform)\r\n\r\n    var plane = this.createBox(\r\n      this.size * 100,\r\n      this.size * 100,\r\n      0.01)\r\n\r\n    plane.applyMatrix(transform)\r\n\r\n    subTorus.visible = false\r\n\r\n    this.viewer.impl.addOverlay(\r\n      this.overlayScene, torusGizmo)\r\n\r\n    this.viewer.impl.addOverlay(\r\n      this.overlayScene, subTorus)\r\n\r\n    torusGizmo.subGizmo = subTorus\r\n    torusGizmo.plane = plane\r\n    torusGizmo.axis = axis\r\n\r\n    return torusGizmo\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Draw a box\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  createBox (w, h, d) {\r\n\r\n    var material = new GizmoMaterial({\r\n      color: 0x000000\r\n    })\r\n\r\n    var geometry = new THREE.BoxGeometry(w, h, d)\r\n\r\n    var box = new THREE.Mesh(\r\n      geometry, material)\r\n\r\n    box.visible = false\r\n\r\n    this.viewer.impl.addOverlay(\r\n      this.overlayScene, box)\r\n\r\n    return box\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Draw a sphere\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  createSphere (radius) {\r\n\r\n    var material = new GizmoMaterial({\r\n      color: 0xFFFF00\r\n    })\r\n\r\n    var geometry = new THREE.SphereGeometry(\r\n      radius, 32, 32)\r\n\r\n    var sphere = new THREE.Mesh(\r\n      geometry, material)\r\n\r\n    sphere.visible = false\r\n\r\n    this.viewer.impl.addOverlay(\r\n      this.overlayScene, sphere)\r\n\r\n    return sphere\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Creates Raycatser object from the pointer\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  pointerToRaycaster (pointer) {\r\n\r\n    var pointerVector = new THREE.Vector3()\r\n    var pointerDir = new THREE.Vector3()\r\n    var ray = new THREE.Raycaster()\r\n\r\n    var rect = this.domElement.getBoundingClientRect()\r\n\r\n    var x = ((pointer.clientX - rect.left) / rect.width) * 2 - 1\r\n    var y = -((pointer.clientY - rect.top) / rect.height) * 2 + 1\r\n\r\n    if (this.camera.isPerspective) {\r\n\r\n      pointerVector.set(x, y, 0.5)\r\n\r\n      pointerVector.unproject(this.camera)\r\n\r\n      ray.set(this.camera.position,\r\n        pointerVector.sub(\r\n          this.camera.position).normalize())\r\n\r\n    } else {\r\n\r\n      pointerVector.set(x, y, -1)\r\n\r\n      pointerVector.unproject(this.camera)\r\n\r\n      pointerDir.set(0, 0, -1)\r\n\r\n      ray.set(pointerVector,\r\n        pointerDir.transformDirection(\r\n          this.camera.matrixWorld))\r\n    }\r\n\r\n    return ray\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  onPointerDown (event) {\r\n\r\n    var pointer = event.pointers ? event.pointers[ 0 ] : event\r\n\r\n    if (pointer.button === 0) {\r\n\r\n      var ray = this.pointerToRaycaster(pointer)\r\n\r\n      var intersectResults = ray.intersectObjects(\r\n        this.gizmos, true)\r\n\r\n      if (intersectResults.length) {\r\n\r\n        this.gizmos.forEach((gizmo) => {\r\n\r\n          gizmo.visible = false\r\n        })\r\n\r\n        this.selectedGizmo = intersectResults[0].object\r\n\r\n        this.selectedGizmo.subGizmo.visible = true\r\n\r\n        this.picker.position.copy(\r\n          intersectResults[0].point)\r\n\r\n        this.angleLine.geometry.vertices[1].copy(\r\n          intersectResults[0].point)\r\n\r\n        this.lastDir = intersectResults[0].point.sub(\r\n          this.center).normalize()\r\n\r\n        this.angleLine.geometry.verticesNeedUpdate = true\r\n\r\n        this.angleLine.visible = true\r\n\r\n        this.picker.visible = true\r\n\r\n      } else {\r\n\r\n        this.picker.visible = false\r\n      }\r\n\r\n      this.engaged = this.picker.visible\r\n\r\n      this.viewer.impl.sceneUpdated(true)\r\n    }\r\n\r\n    return this.picker.visible\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  onPointerHover (event) {\r\n\r\n    var pointer = event.pointers ? event.pointers[ 0 ] : event\r\n\r\n    if (this.engaged) {\r\n\r\n      var ray = this.pointerToRaycaster(pointer)\r\n\r\n      var intersectResults = ray.intersectObjects(\r\n        [this.selectedGizmo.plane], true)\r\n\r\n      if (intersectResults.length) {\r\n\r\n        var intersectPoint = intersectResults[0].point\r\n\r\n        var dir = intersectPoint.sub(\r\n          this.center).normalize()\r\n\r\n        var cross = new THREE.Vector3()\r\n\r\n        cross.crossVectors(this.lastDir, dir)\r\n\r\n        var sign = Math.sign(\r\n          cross.dot(this.selectedGizmo.axis))\r\n\r\n        this.emit('rotate', {\r\n          angle: sign * dir.angleTo(this.lastDir),\r\n          axis: this.selectedGizmo.axis\r\n        })\r\n\r\n        this.lastDir = dir\r\n\r\n        var pickerPoint = new THREE.Vector3(\r\n          this.center.x + dir.x * this.size * 0.8,\r\n          this.center.y + dir.y * this.size * 0.8,\r\n          this.center.z + dir.z * this.size * 0.8)\r\n\r\n        this.picker.position.copy(\r\n          pickerPoint)\r\n\r\n        this.angleLine.geometry.vertices[1].copy(\r\n          pickerPoint)\r\n      }\r\n\r\n      this.angleLine.visible = true\r\n\r\n      this.angleLine.geometry.verticesNeedUpdate = true\r\n\r\n    } else {\r\n\r\n      this.angleLine.visible = false\r\n\r\n      var ray = this.pointerToRaycaster(pointer)\r\n\r\n      var intersectResults = ray.intersectObjects(\r\n        this.gizmos, true)\r\n\r\n      if (intersectResults.length) {\r\n\r\n        this.picker.position.set(\r\n          intersectResults[ 0 ].point.x,\r\n          intersectResults[ 0 ].point.y,\r\n          intersectResults[ 0 ].point.z)\r\n\r\n        this.picker.visible = true\r\n\r\n      } else {\r\n\r\n        this.picker.visible = false\r\n      }\r\n    }\r\n\r\n    this.viewer.impl.sceneUpdated(true)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  onPointerUp (event) {\r\n\r\n    this.angleLine.visible = false\r\n\r\n    this.picker.visible = false\r\n\r\n    this.gizmos.forEach((gizmo) => {\r\n\r\n      gizmo.visible = true\r\n      gizmo.subGizmo.visible = false\r\n    })\r\n\r\n    this.viewer.impl.sceneUpdated(true)\r\n\r\n    setTimeout(() => {\r\n      this.engaged = false\r\n    }, 100)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  normalize(screenPoint) {\r\n\r\n    var viewport = this.viewer.navigation.getScreenViewport()\r\n\r\n    var n = {\r\n      x: (screenPoint.x - viewport.left) / viewport.width,\r\n      y: (screenPoint.y - viewport.top) / viewport.height\r\n    }\r\n\r\n    return n\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  projectOntoPlane (worldPoint, normal) {\r\n\r\n    var dist = normal.dot(worldPoint)\r\n\r\n    return new THREE.Vector3(\r\n      worldPoint.x - dist * normal.x,\r\n      worldPoint.y - dist * normal.y,\r\n      worldPoint.z - dist * normal.z)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  remove () {\r\n\r\n    this.viewer.impl.removeOverlayScene(\r\n      this.overlayScene)\r\n  }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Highlightable Gizmo Material\r\n//\r\n///////////////////////////////////////////////////////////////////////////////\r\nclass GizmoMaterial extends THREE.MeshBasicMaterial {\r\n\r\n  constructor (parameters) {\r\n\r\n    super()\r\n\r\n    this.setValues(parameters)\r\n\r\n    this.colorInit = this.color.clone()\r\n    this.opacityInit = this.opacity\r\n    this.side = THREE.FrontSide\r\n    this.depthWrite = false\r\n    this.transparent = true\r\n    this.depthTest = false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  highlight (highlighted) {\r\n\r\n    if (highlighted) {\r\n\r\n      this.color.setRGB(1, 230 / 255, 3 / 255)\r\n      this.opacity = 1\r\n\r\n    } else {\r\n\r\n      this.color.copy(this.colorInit)\r\n      this.opacity = this.opacityInit\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/Viewing.Tool.Rotate.js","import EventsEmitter from 'EventsEmitter'\r\nimport './TransformGizmos'\r\n\r\nexport default class TranslateTool extends EventsEmitter {\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  // Class constructor\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  constructor (viewer) {\r\n\r\n    super()\r\n\r\n    this._dbIds = []\r\n\r\n    this.active = false\r\n\r\n    this._viewer = viewer\r\n\r\n    this._isDragging = false\r\n\r\n    this.fullTransform = false\r\n\r\n    this._transformMesh = null\r\n\r\n    this._selectedFragProxyMap = {}\r\n\r\n    this._transformControlTx = null\r\n\r\n    this._hitPoint = new THREE.Vector3()\r\n\r\n    this.onTxChange =\r\n      this.onTxChange.bind(this)\r\n\r\n    this.onAggregateSelectionChanged =\r\n      this.onAggregateSelectionChanged.bind(this)\r\n\r\n    this.onCameraChanged =\r\n      this.onCameraChanged.bind(this)\r\n\r\n    this._selectionMode = 'SELECTION_MODE_TRANSFORM'\r\n\r\n    viewer.toolController.registerTool(this)\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  getNames () {\r\n\r\n    return ['Viewing.Tool.Translate']\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  getName () {\r\n\r\n    return 'Viewing.Tool.Translate'\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // Creates a dummy mesh to attach control to\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  createTransformMesh() {\r\n\r\n    var material = new THREE.MeshPhongMaterial(\r\n      { color: 0xff0000 })\r\n\r\n    this._viewer.impl.matman().addMaterial(\r\n      'transform-tool-material',\r\n      material,\r\n      true)\r\n\r\n    var sphere = new THREE.Mesh(\r\n      new THREE.SphereGeometry(0.0001, 5),\r\n      material)\r\n\r\n    sphere.position.set(0, 0, 0)\r\n\r\n    return sphere\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // on translation change\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  onTxChange() {\r\n\r\n    if(this._isDragging && this._transformControlTx.visible) {\r\n\r\n      var translation = new THREE.Vector3(\r\n        this._transformMesh.position.x - this._selection.model.offset.x,\r\n        this._transformMesh.position.y - this._selection.model.offset.y,\r\n        this._transformMesh.position.z - this._selection.model.offset.z)\r\n\r\n      for(var fragId in this._selectedFragProxyMap) {\r\n\r\n        var fragProxy = this._selectedFragProxyMap[fragId]\r\n\r\n        var position = new THREE.Vector3(\r\n          this._transformMesh.position.x - fragProxy.offset.x,\r\n          this._transformMesh.position.y - fragProxy.offset.y,\r\n          this._transformMesh.position.z - fragProxy.offset.z)\r\n\r\n        fragProxy.position = position\r\n\r\n        fragProxy.updateAnimTransform()\r\n      }\r\n\r\n      this.emit('translate', {\r\n        fragIds: Object.keys(this._selectedFragProxyMap),\r\n        model: this._selection.model,\r\n        translation: translation\r\n      })\r\n    }\r\n\r\n    this._viewer.impl.sceneUpdated(true)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // on camera changed\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  onCameraChanged() {\r\n\r\n    if(this._transformControlTx) {\r\n\r\n      this._transformControlTx.update()\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // item selected callback\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  onAggregateSelectionChanged (event) {\r\n\r\n    switch (this._selectionMode) {\r\n\r\n      case 'SELECTION_MODE_TRANSFORM':\r\n\r\n        if (this._selection && this.pointerDown) {\r\n\r\n          this._selectionMode = 'SELECTION_MODE_RESUME_TRANSFORM'\r\n\r\n          this._viewer.clearSelection()\r\n\r\n          this._viewer.select(this._dbIds)\r\n\r\n          return\r\n        }\r\n\r\n        if (event.selections.length) {\r\n\r\n          var selection = event.selections[0]\r\n\r\n          this.setSelection(selection)\r\n\r\n        } else {\r\n\r\n          this.clearSelection()\r\n        }\r\n\r\n        break;\r\n\r\n      case 'SELECTION_MODE_PICK':\r\n\r\n        if(event.selections && event.selections.length) {\r\n\r\n          this._selectionMode = 'SELECTION_MODE_RESUME_TRANSFORM'\r\n\r\n          this._viewer.clearSelection()\r\n\r\n          this._viewer.select(this._dbIds)\r\n\r\n          this.setPosition(this._hitPoint)\r\n        }\r\n\r\n      case 'SELECTION_MODE_RESUME_TRANSFORM':\r\n\r\n        setTimeout(() => {\r\n\r\n          this._selectionMode = 'SELECTION_MODE_TRANSFORM'\r\n        }, 300)\r\n\r\n        break;\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  setSelection (selection) {\r\n\r\n    this._selection = selection\r\n\r\n    this._dbIds = this._selection.dbIdArray\r\n\r\n    if (this.fullTransform) {\r\n\r\n      this._selection.fragIdsArray = []\r\n\r\n      var fragCount = this._selection.model.getFragmentList().\r\n        fragments.fragId2dbId.length\r\n\r\n      for (var fragId = 0; fragId < fragCount; ++fragId) {\r\n\r\n        this._selection.fragIdsArray.push(fragId)\r\n      }\r\n\r\n      this._selection.dbIdArray = []\r\n\r\n      var instanceTree =\r\n        this._selection.model.getData().instanceTree\r\n\r\n      var rootId = instanceTree.getRootId()\r\n\r\n      this._selection.dbIdArray.push(rootId)\r\n    }\r\n\r\n    this.initializeSelection(\r\n      this._hitPoint)\r\n\r\n    this.emit('selection', selection)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  initializeSelection (hitPoint) {\r\n\r\n    this._selectedFragProxyMap = {}\r\n\r\n    var modelTransform = this._selection.model.transform ||\r\n      { translation: { x:0, y:0, z:0 } }\r\n\r\n    this._selection.model.offset = {\r\n      x: hitPoint.x - modelTransform.translation.x,\r\n      y: hitPoint.y - modelTransform.translation.y,\r\n      z: hitPoint.z - modelTransform.translation.z\r\n    }\r\n\r\n    this._transformControlTx.visible = true\r\n\r\n    this._transformControlTx.setPosition(\r\n      hitPoint)\r\n\r\n    this._transformControlTx.addEventListener(\r\n      'change', this.onTxChange)\r\n\r\n    this._viewer.addEventListener(\r\n      Autodesk.Viewing.CAMERA_CHANGE_EVENT,\r\n      this.onCameraChanged)\r\n\r\n    this._selection.fragIdsArray.forEach((fragId) => {\r\n\r\n      var fragProxy = this._viewer.impl.getFragmentProxy(\r\n        this._selection.model,\r\n        fragId)\r\n\r\n      fragProxy.getAnimTransform()\r\n\r\n      fragProxy.offset = {\r\n\r\n        x: hitPoint.x - fragProxy.position.x,\r\n        y: hitPoint.y - fragProxy.position.y,\r\n        z: hitPoint.z - fragProxy.position.z\r\n      }\r\n\r\n      this._selectedFragProxyMap[fragId] = fragProxy\r\n    })\r\n\r\n    this._viewer.impl.sceneUpdated(true)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  clearSelection () {\r\n\r\n    if (this.active) {\r\n\r\n      this._selection = null\r\n\r\n      this._selectedFragProxyMap = {}\r\n\r\n      this._transformControlTx.visible = false\r\n\r\n      this._transformControlTx.removeEventListener(\r\n        'change', this.onTxChange)\r\n\r\n      this._viewer.removeEventListener(\r\n        Autodesk.Viewing.CAMERA_CHANGE_EVENT,\r\n        this.onCameraChanged)\r\n\r\n      this._viewer.impl.sceneUpdated(true)\r\n\r\n      this.emit('selection', null)\r\n    }\r\n  }\r\n\r\n  //////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  setPosition (position) {\r\n\r\n    this._transformControlTx.setPosition(position)\r\n\r\n    for (var fragId in this._selectedFragProxyMap) {\r\n\r\n      var fragProxy = this._selectedFragProxyMap[fragId]\r\n\r\n      var fragPosition = new THREE.Vector3(\r\n        position.x - fragProxy.offset.x,\r\n        position.y - fragProxy.offset.y,\r\n        position.z - fragProxy.offset.z)\r\n\r\n      fragProxy.position = fragPosition\r\n\r\n      fragProxy.updateAnimTransform()\r\n    }\r\n\r\n    var translation = new THREE.Vector3(\r\n      this._transformMesh.position.x - this._selection.model.offset.x,\r\n      this._transformMesh.position.y - this._selection.model.offset.y,\r\n      this._transformMesh.position.z - this._selection.model.offset.z)\r\n\r\n    this.emit('translate', {\r\n      fragIds: Object.keys(this._selectedFragProxyMap),\r\n      model: this._selection.model,\r\n      translation: translation,\r\n      dbIds: this._dbIds\r\n    })\r\n\r\n    this._viewer.impl.sceneUpdated(true)\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // normalize screen coordinates\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  normalize (screenPoint) {\r\n\r\n    var viewport = this._viewer.navigation.getScreenViewport()\r\n\r\n    var n = {\r\n      x: (screenPoint.x - viewport.left) / viewport.width,\r\n      y: (screenPoint.y - viewport.top) / viewport.height\r\n    }\r\n\r\n    return n\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // get 3d hit point on mesh\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  getHitPoint (event) {\r\n\r\n    var screenPoint = {\r\n      x: event.clientX,\r\n      y: event.clientY\r\n    }\r\n\r\n    var n = this.normalize(screenPoint)\r\n\r\n    var hitPoint = this._viewer.utilities.getHitPoint(n.x, n.y)\r\n\r\n    return hitPoint\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  hitPoint () {\r\n\r\n    return this._transformControlTx.position\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  setHitPoint (hitPoint) {\r\n\r\n    this._hitPoint.x = hitPoint.x\r\n    this._hitPoint.y = hitPoint.y\r\n    this._hitPoint.z = hitPoint.z\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////\r\n  activate () {\r\n\r\n    if(!this.active) {\r\n\r\n      this.active = true\r\n\r\n      this._viewer.toolController.activateTool(this.getName())\r\n\r\n      var bbox = this._viewer.model.getBoundingBox()\r\n\r\n      this._viewer.impl.createOverlayScene(\r\n        'TranslateToolOverlay')\r\n\r\n      this._transformControlTx = new THREE.TransformControls(\r\n        this._viewer.impl.camera,\r\n        this._viewer.impl.canvas,\r\n        \"translate\")\r\n\r\n      this._transformControlTx.setSize(\r\n        bbox.getBoundingSphere().radius * 5)\r\n\r\n      this._transformControlTx.visible = false\r\n\r\n      this._viewer.impl.addOverlay(\r\n        'TranslateToolOverlay',\r\n        this._transformControlTx)\r\n\r\n      this._transformMesh = this.createTransformMesh()\r\n\r\n      this._transformControlTx.attach(\r\n        this._transformMesh)\r\n\r\n      this._viewer.addEventListener(\r\n        Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,\r\n        this.onAggregateSelectionChanged)\r\n\r\n      this.emit('activate')\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  // deactivate tool\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  deactivate () {\r\n\r\n    if (this.active) {\r\n\r\n      this.active = false\r\n\r\n      this._viewer.toolController.deactivateTool(this.getName())\r\n\r\n      this._viewer.impl.removeOverlay(\r\n        'TranslateToolOverlay',\r\n        this._transformControlTx)\r\n\r\n      this._transformControlTx.removeEventListener(\r\n        'change', this.onTxChange)\r\n\r\n      this._viewer.impl.removeOverlayScene(\r\n        'TranslateToolOverlay')\r\n\r\n      this._viewer.removeEventListener(\r\n        Autodesk.Viewing.CAMERA_CHANGE_EVENT,\r\n        this.onCameraChanged)\r\n\r\n      this._viewer.removeEventListener(\r\n        Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,\r\n        this.onAggregateSelectionChanged)\r\n\r\n      this.emit('deactivate')\r\n    }\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  onPick () {\r\n\r\n    if (this.active) {\r\n\r\n      this._selectionMode = 'SELECTION_MODE_PICK'\r\n    }\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleButtonDown(event, button) {\r\n\r\n    this._isDragging = true\r\n\r\n    this.pointerDown = this._transformControlTx.onPointerDown(event)\r\n\r\n    if (this.pointerDown && this._selection)\r\n      return true\r\n\r\n    var hitPoint = this.getHitPoint(event)\r\n\r\n    if (hitPoint) {\r\n\r\n      this._hitPoint.copy(hitPoint)\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleButtonUp (event) {\r\n\r\n    this._isDragging = false\r\n\r\n    if (this._transformControlTx.onPointerUp(event))\r\n      return true\r\n\r\n    return false\r\n  }\r\n\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  ///////////////////////////////////////////////////////////////////////////\r\n  handleMouseMove(event) {\r\n\r\n    if (this._isDragging) {\r\n\r\n      if (this._transformControlTx.onPointerMove(event) ) {\r\n\r\n        return true\r\n      }\r\n\r\n      return false\r\n    }\r\n\r\n    if (this._transformControlTx.onPointerHover(event))\r\n      return true\r\n\r\n    return false\r\n  }\r\n\r\n  /////////////////////////////////////////////////////////////////\r\n  //\r\n  //\r\n  /////////////////////////////////////////////////////////////////\r\n  handleKeyDown (event, keyCode) {\r\n\r\n    if (keyCode === 27) { //ESC\r\n\r\n      this._viewer.clearSelection()\r\n      this.deactivate()\r\n    }\r\n\r\n    return false\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/client/viewer.components/Viewer.Extensions.Dynamic/Viewing.Extension.Transform/Viewing.Tool.Translate.js"],"sourceRoot":""}